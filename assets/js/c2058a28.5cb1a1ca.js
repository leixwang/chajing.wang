"use strict";(self.webpackChunkleix_wang_website=self.webpackChunkleix_wang_website||[]).push([[723],{3905:function(e,n,r){r.d(n,{Zo:function(){return p},kt:function(){return d}});var t=r(7294);function s(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){s(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n){if(null==e)return{};var r,t,s=function(e,n){if(null==e)return{};var r,t,s={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var i=t.createContext({}),u=function(e){var n=t.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},p=function(e){var n=u(e.components);return t.createElement(i.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,s=e.mdxType,a=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=u(r),d=s,g=m["".concat(i,".").concat(d)]||m[d]||c[d]||a;return r?t.createElement(g,l(l({ref:n},p),{},{components:r})):t.createElement(g,l({ref:n},p))}));function d(e,n){var r=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=r.length,l=new Array(a);l[0]=m;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:s,l[1]=o;for(var u=2;u<a;u++)l[u]=r[u];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},8171:function(e,n,r){r.r(n),r.d(n,{frontMatter:function(){return o},contentTitle:function(){return i},metadata:function(){return u},toc:function(){return p},default:function(){return m}});var t=r(7462),s=r(3366),a=(r(7294),r(3905)),l=["components"],o={sidebar_position:6},i="\u79df\u623f\u7f51",u={unversionedId:"golang/home",id:"golang/home",title:"\u79df\u623f\u7f51",description:"1.REST\u8be6\u89e3",source:"@site/docs/01.golang/06.home.md",sourceDirName:"01.golang",slug:"/golang/home",permalink:"/docs/golang/home",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"\u5fae\u670d\u52a1\uff08micro services\uff09",permalink:"/docs/golang/micro-server"}},p=[{value:"1.REST\u8be6\u89e3",id:"1rest\u8be6\u89e3",children:[],level:2},{value:"2.IHome\u5f00\u53d1",id:"2ihome\u5f00\u53d1",children:[{value:"2.1\u521b\u5efa\u9879\u76ee",id:"21\u521b\u5efa\u9879\u76ee",children:[],level:3},{value:"2.2\u5f00\u53d1\u524d\u51c6\u5907",id:"22\u5f00\u53d1\u524d\u51c6\u5907",children:[{value:"2.2.1\u521b\u5efa\u5de5\u5177\u7c7b\u6587\u4ef6\u5939",id:"221\u521b\u5efa\u5de5\u5177\u7c7b\u6587\u4ef6\u5939",children:[],level:4},{value:"2.2.2\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868",id:"222\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868",children:[],level:4},{value:"2.2.3\u5bfc\u5165\u524d\u7aef\u9875\u9762\u5e76\u5c55\u793a",id:"223\u5bfc\u5165\u524d\u7aef\u9875\u9762\u5e76\u5c55\u793a",children:[],level:4}],level:3},{value:"2.3\u83b7\u53d6\u5730\u57df\u4fe1\u606f",id:"23\u83b7\u53d6\u5730\u57df\u4fe1\u606f",children:[{value:"<strong>2.3.1\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b</strong>",id:"231\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b",children:[],level:4},{value:"<strong>2.3.2\u4e1a\u52a1\u6d41\u7a0b\u56fe</strong>",id:"232\u4e1a\u52a1\u6d41\u7a0b\u56fe",children:[],level:4},{value:"2.3.3\u6dfb\u52a0\u5bf9\u5e94\u8def\u7531\u548c\u4e1a\u52a1\u5904\u7406",id:"233\u6dfb\u52a0\u5bf9\u5e94\u8def\u7531\u548c\u4e1a\u52a1\u5904\u7406",children:[],level:4},{value:"2.3.4\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",id:"234\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",children:[],level:4},{value:"2.3.5web\u7aef\u56de\u8c03\u670d\u52a1\u63a5\u53e3",id:"235web\u7aef\u56de\u8c03\u670d\u52a1\u63a5\u53e3",children:[],level:4}],level:3},{value:"2.4\u83b7\u53d6\u9a8c\u8bc1\u7801\u4e1a\u52a1\u5b9e\u73b0",id:"24\u83b7\u53d6\u9a8c\u8bc1\u7801\u4e1a\u52a1\u5b9e\u73b0",children:[{value:"2.4.1\u6a21\u62df\u56de\u590dsession\u8bf7\u6c42",id:"241\u6a21\u62df\u56de\u590dsession\u8bf7\u6c42",children:[],level:4},{value:"2.4.2\u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247",id:"242\u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247",children:[],level:4},{value:"2.4.3\u4e1a\u52a1\u6d41\u7a0b\u56fe",id:"243\u4e1a\u52a1\u6d41\u7a0b\u56fe",children:[],level:4},{value:"2.4.4\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",id:"244\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",children:[],level:4},{value:"2.4.5web\u7aef\u63a5\u6536\u6570\u636e\u5e76\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668",id:"245web\u7aef\u63a5\u6536\u6570\u636e\u5e76\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668",children:[],level:4}],level:3},{value:"2.5\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801",id:"25\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801",children:[{value:"2.5.1\u63a5\u53e3\u5b9a\u4e49",id:"251\u63a5\u53e3\u5b9a\u4e49",children:[],level:4},{value:"2.5.2\u4e1a\u52a1\u6d41\u7a0b\u56fe",id:"252\u4e1a\u52a1\u6d41\u7a0b\u56fe",children:[],level:4},{value:"2.5.3\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",id:"253\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",children:[],level:4},{value:"2.5.4web\u7aef\u5b9e\u73b0",id:"254web\u7aef\u5b9e\u73b0",children:[],level:4}],level:3},{value:"2.6\u53d1\u9001\u6ce8\u518c\u4fe1\u606f\u670d\u52a1",id:"26\u53d1\u9001\u6ce8\u518c\u4fe1\u606f\u670d\u52a1",children:[{value:"2.6.1\u63a5\u53e3\u5b9a\u4e49",id:"261\u63a5\u53e3\u5b9a\u4e49",children:[],level:4},{value:"2.6.2\u4e1a\u52a1\u6d41\u7a0b\u56fe",id:"262\u4e1a\u52a1\u6d41\u7a0b\u56fe",children:[],level:4},{value:"2.6.3\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",id:"263\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0",children:[],level:4},{value:"2.6.4session\u4e2d\u95f4\u4ef6\u4f7f\u7528",id:"264session\u4e2d\u95f4\u4ef6\u4f7f\u7528",children:[],level:4},{value:"2.6.5web\u7aef\u5b9e\u73b0",id:"265web\u7aef\u5b9e\u73b0",children:[],level:4}],level:3}],level:2}],c={toc:p};function m(e){var n=e.components,o=(0,s.Z)(e,l);return(0,a.kt)("wrapper",(0,t.Z)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u79df\u623f\u7f51"},"\u79df\u623f\u7f51"),(0,a.kt)("h2",{id:"1rest\u8be6\u89e3"},"1.REST\u8be6\u89e3"),(0,a.kt)("p",null,"\u5728\u8fdb\u884c\u5f00\u53d1\u524d\uff0c\u8fd9\u91cc\u9762\u9700\u8981\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e2a\u6982\u5ff5\uff0c",(0,a.kt)("strong",{parentName:"p"},"REST"),"\u3002"),(0,a.kt)("p",null,"REST\u5168\u79f0\u662fRepresentational State Transfer\uff0c\u4e2d\u6587\u610f\u601d\u662f\u8868\u8ff0\uff08\u7f16\u8005\u6ce8\uff1a\u901a\u5e38\u8bd1\u4e3a\u8868\u5f81\uff09\u6027\u72b6\u6001\u8f6c\u79fb\u3002 "),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u4e5f\u6709\u8bf4\u5168\u79f0\u662f Resource Representational State Transfer  \u8d44\u6e90\u8868\u73b0\u72b6\u6001\u8f6c\u79fb")),(0,a.kt)("p",null,"\u662fRoy Thomas Fielding\u535a\u58eb\u4e8e2000\u5e74\u5728\u4ed6\u7684\u535a\u58eb\u8bba\u6587\u4e2d\u63d0\u51fa\u6765\u7684\u4e00\u79cd\u4e07\u7ef4\u7f51\u8f6f\u4ef6\u67b6\u6784\u98ce\u683c\uff0c\u76ee\u7684\u662f\u4fbf\u4e8e\u4e0d\u540c\u8f6f\u4ef6/\u7a0b\u5e8f\u5728\u7f51\u7edc\uff08\u4f8b\u5982\u4e92\u8054\u7f51\uff09\u4e2d\u4e92\u76f8\u4f20\u9012\u4fe1\u606f\u3002\u8868\u73b0\u5c42\u72b6\u6001\u8f6c\u6362\u662f\u6839\u57fa\u4e8e\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae(HTTP)\u4e4b\u4e0a\u800c\u786e\u5b9a\u7684\u4e00\u7ec4\u7ea6\u675f\u548c\u5c5e\u6027\uff0c\u662f\u4e00\u79cd\u8bbe\u8ba1\u63d0\u4f9b\u4e07\u7ef4\u7f51\u7edc\u670d\u52a1\u7684\u8f6f\u4ef6\u6784\u5efa\u98ce\u683c\u3002\u7b26\u5408\u6216\u517c\u5bb9\u4e8e\u8fd9\u79cd\u67b6\u6784\u98ce\u683c(\u7b80\u79f0\u4e3a REST \u6216 RESTful)\u7684\u7f51\u7edc\u670d\u52a1\uff0c\u5141\u8bb8\u5ba2\u6237\u7aef\u53d1\u51fa\u4ee5\u7edf\u4e00\u8d44\u6e90\u6807\u8bc6\u7b26\u8bbf\u95ee\u548c\u64cd\u4f5c\u7f51\u7edc\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u800c\u4e0e\u9884\u5148\u5b9a\u4e49\u597d\u7684\u65e0\u72b6\u6001\u64cd\u4f5c\u96c6\u4e00\u81f4\u5316\u3002\u56e0\u6b64\u8868\u73b0\u5c42\u72b6\u6001\u8f6c\u6362\u63d0\u4f9b\u4e86\u5728\u4e92\u8054\u7f51\u7edc\u7684\u8ba1\u7b97\u7cfb\u7edf\u4e4b\u95f4\uff0c\u5f7c\u6b64\u8d44\u6e90\u53ef\u4ea4\u4e92\u4f7f\u7528\u7684\u534f\u4f5c\u6027\u8d28(interoperability)\u3002\u76f8\u5bf9\u4e8e\u5176\u5b83\u79cd\u7c7b\u7684\u7f51\u7edc\u670d\u52a1\uff0c\u4f8b\u5982 SOAP\u670d\u52a1\u5219\u662f\u4ee5\u672c\u8eab\u6240\u5b9a\u4e49\u7684\u64cd\u4f5c\u96c6\uff0c\u6765\u8bbf\u95ee\u7f51\u7edc\u4e0a\u7684\u8d44\u6e90\u3002"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\uff08\u6458\u81ea\u7ef4\u57fa\u767e\u79d1\uff09")),(0,a.kt)("p",null,"\u6982\u5ff5\u4e00\u822c\u90fd\u6bd4\u8f83\u6666\u6da9\u96be\u61c2\uff0c\u6211\u4eec\u770b\u4e00\u4e0b\u77e5\u4e4e\u5927\u795e\u7ed9\u51fa\u7684\u7b80\u6d01\u7248\u4ecb\u7ecd\uff1a"),(0,a.kt)("p",null,'1.REST\u4e0d\u662f"rest"\u8fd9\u4e2a\u5355\u8bcd\uff0c\u800c\u662f\u51e0\u4e2a\u5355\u8bcd\u7f29\u5199\u3002\u4f46\u5373\u4f7f\u90a3\u51e0\u4e2a\u5355\u8bcd\u8bf4\u51fa\u6765\uff0c\u4e5f\u65e0\u6cd5\u7406\u89e3\u5728\u8bf4\u4ec0\u4e48 -_-!! \uff08\u4e0d\u662f\u8981\u8d2c\u4f4e\u4eba\uff0c\u662f\u6211\u81ea\u5df1\u4e5f\u7406\u89e3\u56f0\u96be\uff09\uff1b'),(0,a.kt)("p",null,"2.REST\u63cf\u8ff0\u7684\u662f\u5728\u7f51\u7edc\u4e2dclient\u548cserver\u7684\u4e00\u79cd\u4ea4\u4e92\u5f62\u5f0f\uff1bREST\u672c\u8eab\u4e0d\u5b9e\u7528\uff0c\u5b9e\u7528\u7684\u662f\u5982\u4f55\u8bbe\u8ba1 RESTful API\uff08REST\u98ce\u683c\u7684\u7f51\u7edc\u63a5\u53e3\uff09\uff1b"),(0,a.kt)("p",null,"3.Server\u63d0\u4f9b\u7684RESTful API\u4e2d\uff0cURL\u4e2d\u53ea\u4f7f\u7528\u540d\u8bcd\u6765\u6307\u5b9a\u8d44\u6e90\uff0c\u539f\u5219\u4e0a\u4e0d\u4f7f\u7528\u52a8\u8bcd\u3002\u201c\u8d44\u6e90\u201d\u662fREST\u67b6\u6784\u6216\u8005\u8bf4\u6574\u4e2a\u7f51\u7edc\u5904\u7406\u7684\u6838\u5fc3\u3002\u6bd4\u5982\uff1a"),(0,a.kt)("p",null,"URL\u5168\u5c40\u8d44\u6e90\u5b9a\u4f4d\u7b26  locat   restful"),(0,a.kt)("p",null,"URI:\u5168\u5c40\u8d44\u6e90\u6807\u8bc6\u7b26  identify"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/newsfeed"),": \u83b7\u53d6\u67d0\u4eba\u7684\u65b0\u9c9c;\n",(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/friends"),": \u83b7\u53d6\u67d0\u4eba\u7684\u597d\u53cb\u5217\u8868;\n",(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/profile"),": \u83b7\u53d6\u67d0\u4eba\u7684\u8be6\u7ec6\u4fe1\u606f;"),(0,a.kt)("p",null,"4 .\u7528HTTP\u534f\u8bae\u91cc\u7684\u52a8\u8bcd\u6765\u5b9e\u73b0\u8d44\u6e90\u7684\u6dfb\u52a0\uff0c\u4fee\u6539\uff0c\u5220\u9664\u7b49\u64cd\u4f5c\u3002\u5373\u901a\u8fc7HTTP\u52a8\u8bcd\u6765\u5b9e\u73b0\u8d44\u6e90\u7684\u72b6\u6001\u626d\u8f6c\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565331217181",src:r(6245).Z})),(0,a.kt)("p",null,"\u6bd4\u5982\uff1a\nDELETE ",(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/friends"),": \u5220\u9664\u67d0\u4eba\u7684\u597d\u53cb \uff08\u5728http parameter\u6307\u5b9a\u597d\u53cbid\uff09\nPOST ",(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/"),"friends: \u6dfb\u52a0\u597d\u53cb\nUPDATE ",(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/profile"),": \u66f4\u65b0\u4e2a\u4eba\u8d44\u6599"),(0,a.kt)("p",null,"\u7981\u6b62\u4f7f\u7528\uff1a GET ",(0,a.kt)("inlineCode",{parentName:"p"},"http://api.qc.com/v1/deleteFriend")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Restful\u7684\u597d\u5904")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u8f7b\u91cf\uff0c\u76f4\u63a5\u57fa\u4e8ehttp\uff0c\u4e0d\u518d\u9700\u8981\u4efb\u4f55\u522b\u7684\u8bf8\u5982\u6d88\u606f\u534f\u8bae\u3002get/post/put/delete\u4e3aCRUD\u64cd\u4f5c")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u9762\u5411\u8d44\u6e90\uff0c\u4e00\u76ee\u4e86\u7136\uff0c\u5177\u6709\u81ea\u89e3\u91ca\u6027\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6570\u636e\u63cf\u8ff0\u7b80\u5355\uff0c\u4e00\u822c\u4ee5xml\uff0cjson\u505a\u6570\u636e\u4ea4\u6362\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u65e0\u72b6\u6001\uff0c\u5728\u8c03\u7528\u4e00\u4e2a\u63a5\u53e3\uff08\u8bbf\u95ee\u3001\u64cd\u4f5c\u8d44\u6e90\uff09\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4e0d\u7528\u8003\u8651\u4e0a\u4e0b\u6587\uff0c\u4e0d\u7528\u8003\u8651\u5f53\u524d\u72b6\u6001\uff0c\u6781\u5927\u7684\u964d\u4f4e\u4e86\u590d\u6742\u5ea6\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u7b80\u5355\u3001\u4f4e\u8026\u5408"))),(0,a.kt)("p",null,"\u5728web\u5f00\u53d1\u4e2d\uff0crestful\u662f\u975e\u5e38\u5e38\u89c1\u7684\u8bbe\u8ba1\u3002\u5728\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u8def\u7531\u5c3d\u91cf\u4f7f\u7528restful\u98ce\u683c\u3002"),(0,a.kt)("h2",{id:"2ihome\u5f00\u53d1"},"2.IHome\u5f00\u53d1"),(0,a.kt)("h3",{id:"21\u521b\u5efa\u9879\u76ee"},"2.1\u521b\u5efa\u9879\u76ee"),(0,a.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"gin"),"\u6846\u67b6\u4f5c\u4e3aweb\u6846\u67b6\u8fdb\u884c\u5f00\u53d1\uff0c\u9996\u5148\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0bgin\u7684\u4e00\u4e2a\u7b80\u5355\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u9996\u5148\u662fgin\u7684\u4e0b\u8f7d\uff0c\u4e0b\u8f7d\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ go get -u -v github.com/gin-gonic/gin\n")),(0,a.kt)("p",null,"\u7136\u540e\u6211\u4eec\u7528\u7b80\u5355\u7684\u793a\u4f8b\u4ee3\u7801\u7740\u624bgin\u6846\u67b6\u7684\u5b66\u4e60\u4f7f\u7528\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'func main(){\n    //\u521d\u59cb\u5316\u8def\u7531\n    router := gin.Default()\n\n    //\u8def\u7531\u5339\u914d\n    router.GET("/", func(context *gin.Context) {\n        context.Writer.Write([]byte("Hello World"))\n    })\n\n    //\u5f00\u542f\u76d1\u542c\n    router.Run(":8080")\n}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u975e\u5e38\u7b80\u5355\u5c31\u80fd\u5b9e\u73b0\u4e00\u4e2aweb\u670d\u52a1\u5668\u7684\u96cf\u5f62\uff0c\u63a5\u7740\u6211\u4eec\u5728\u9879\u76ee\u5f00\u53d1\u4e2d\u518d\u8be6\u7ec6\u4ecb\u7ecdgin\u7684\u4f7f\u7528"),(0,a.kt)("p",{parentName:"blockquote"},"\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u6709\u4e9b\u5185\u5bb9\u4ecb\u7ecd\u4e0d\u591f\u5168\u9762\uff0c\u5982\u679c\u60f3\u770b\u8be6\u7ec6\u6587\u6863\u53ef\u4ee5\u5728\u4e0b\u9762\u7f51\u5740\u67e5\u770b\uff1a"),(0,a.kt)("p",{parentName:"blockquote"},"github\u539f\u59cb\u5730\u5740\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/gin-gonic/gin"},"https://github.com/gin-gonic/gin")),(0,a.kt)("p",{parentName:"blockquote"},"github\u8865\u5145\u793a\u4f8b\u5730\u5740\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/gin-gonic/examples/"},"https://github.com/gin-gonic/examples/")),(0,a.kt)("p",{parentName:"blockquote"},"gin\u4e2d\u6587\u6587\u6863\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://www.kancloud.cn/shuangdeyu/gin_book/949413"},"https://www.kancloud.cn/shuangdeyu/gin_book/949413"))),(0,a.kt)("h3",{id:"22\u5f00\u53d1\u524d\u51c6\u5907"},"2.2\u5f00\u53d1\u524d\u51c6\u5907"),(0,a.kt)("h4",{id:"221\u521b\u5efa\u5de5\u5177\u7c7b\u6587\u4ef6\u5939"},"2.2.1\u521b\u5efa\u5de5\u5177\u7c7b\u6587\u4ef6\u5939"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"#\u521b\u5efa\u5de5\u5177\u51fd\u6570\u6587\u4ef6\u5939\n$ mkdir utils\n# \u8fdb\u5165\u6587\u4ef6\u5939\u521b\u5efa\u6587\u4ef6\n$ cd utils\n# \u914d\u7f6e\u6587\u4ef6\u8bfb\u53d6\u51fd\u6570\u6587\u4ef6\n$ vim config.go\n# \u9519\u8bef\u7801\u6587\u4ef6\n$ vim error.go\n")),(0,a.kt)("p",null,"\u9519\u8bef\u7801\u6587\u4ef6error.go\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package utils\n\nconst (\n    RECODE_OK         = "0"\n    RECODE_DBERR      = "4001"\n    RECODE_NODATA     = "4002"\n    RECODE_DATAEXIST  = "4003"\n    RECODE_DATAERR    = "4004"\n    \n    RECODE_SESSIONERR = "4101"\n    RECODE_LOGINERR   = "4102"\n    RECODE_PARAMERR   = "4103"\n    RECODE_USERONERR  = "4104"\n    RECODE_ROLEERR    = "4105"\n    RECODE_PWDERR     = "4106"\n    RECODE_USERERR    = "4107"\n    RECODE_SMSERR     = "4108"\n    RECODE_MOBILEERR  = "4109"\n\n    RECODE_REQERR     = "4201"\n    RECODE_IPERR      = "4202"\n    RECODE_THIRDERR   = "4301"\n    RECODE_IOERR      = "4302"\n    RECODE_SERVERERR  = "4500"\n    RECODE_UNKNOWERR  = "4501"\n)\n\nvar recodeText = map[string]string{\n    RECODE_OK:         "\u6210\u529f",\n    RECODE_DBERR:      "\u6570\u636e\u5e93\u67e5\u8be2\u9519\u8bef",\n    RECODE_NODATA:     "\u65e0\u6570\u636e",\n    RECODE_DATAEXIST:  "\u6570\u636e\u5df2\u5b58\u5728",\n    RECODE_DATAERR:    "\u6570\u636e\u9519\u8bef",\n    RECODE_SESSIONERR: "\u7528\u6237\u672a\u767b\u5f55",\n    RECODE_LOGINERR:   "\u7528\u6237\u767b\u5f55\u5931\u8d25",\n    RECODE_PARAMERR:   "\u53c2\u6570\u9519\u8bef",\n    RECODE_USERERR:    "\u7528\u6237\u4e0d\u5b58\u5728\u6216\u672a\u6fc0\u6d3b",\n    RECODE_USERONERR:  "\u7528\u6237\u5df2\u7ecf\u6ce8\u518c",\n    RECODE_ROLEERR:    "\u7528\u6237\u8eab\u4efd\u9519\u8bef",\n    RECODE_PWDERR:     "\u5bc6\u7801\u9519\u8bef",\n    RECODE_REQERR:     "\u975e\u6cd5\u8bf7\u6c42\u6216\u8bf7\u6c42\u6b21\u6570\u53d7\u9650",\n    RECODE_IPERR:      "IP\u53d7\u9650",\n    RECODE_THIRDERR:   "\u7b2c\u4e09\u65b9\u7cfb\u7edf\u9519\u8bef",\n    RECODE_IOERR:      "\u6587\u4ef6\u8bfb\u5199\u9519\u8bef",\n    RECODE_SERVERERR:  "\u5185\u90e8\u9519\u8bef",\n    RECODE_UNKNOWERR:  "\u672a\u77e5\u9519\u8bef",\n    RECODE_SMSERR:     "\u77ed\u4fe1\u5931\u8d25",\n    RECODE_MOBILEERR:  "\u624b\u673a\u53f7\u9519\u8bef",\n}\n\nfunc RecodeText(code string) string {\n    str, ok := recodeText[code]\n    if ok {\n        return str\n    }\n    return recodeText[RECODE_UNKNOWERR]\n}\n')),(0,a.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\uff0c\u7b49\u5230\u6211\u4eec\u5199\u4e1a\u52a1\u4ee3\u7801\u7684\u65f6\u5019\u7ee7\u7eed\u8865\u5145\u3002"),(0,a.kt)("h4",{id:"222\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868"},"2.2.2\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868"),(0,a.kt)("p",null,"\u5148\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u7528\u6765\u5b58\u653e\u6570\u636e\u5e93\u6587\u4ef6\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ mkdir models\n#\u521b\u5efa\u6570\u636e\u5e93\u6587\u4ef6\n$ vim models.go\n")),(0,a.kt)("p",null,"\u6570\u636e\u5e93\u6587\u4ef6models.go\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package model\n\nimport (\n    "time"\n    "github.com/jinzhu/gorm"\n    _ "github.com/jinzhu/gorm/dialects/mysql"\n)\n\n/* \u7528\u6237 table_name = user */\ntype User struct {\n    ID            int                                  //\u7528\u6237\u7f16\u53f7\n    Name          string        `gorm:"size:32;unique"`           //\u7528\u6237\u540d\n    Password_hash string        `gorm:"size:128" `      //\u7528\u6237\u5bc6\u7801\u52a0\u5bc6\u7684\n    Mobile        string        `gorm:"size:11;unique" ` //\u624b\u673a\u53f7\n    Real_name     string        `gorm:"size:32" `      //\u771f\u5b9e\u59d3\u540d  \u5b9e\u540d\u8ba4\u8bc1\n    Id_card       string        `gorm:"size:20" `        //\u8eab\u4efd\u8bc1\u53f7  \u5b9e\u540d\u8ba4\u8bc1\n    Avatar_url    string        `gorm:"size:256" `    //\u7528\u6237\u5934\u50cf\u8def\u5f84       \u901a\u8fc7fastdfs\u8fdb\u884c\u56fe\u7247\u5b58\u50a8\n    Houses        []*House         //\u7528\u6237\u53d1\u5e03\u7684\u623f\u5c4b\u4fe1\u606f  \u4e00\u4e2a\u4eba\u591a\u5957\u623f\n    Orders        []*OrderHouse    //\u7528\u6237\u4e0b\u7684\u8ba2\u5355       \u4e00\u4e2a\u4eba\u591a\u6b21\u8ba2\u5355\n}\n\n\n/* \u623f\u5c4b\u4fe1\u606f table_name = house */\ntype House struct {\n    gorm.Model                     //\u623f\u5c4b\u7f16\u53f7\n    UserId          uint           //\u623f\u5c4b\u4e3b\u4eba\u7684\u7528\u6237\u7f16\u53f7  \u4e0e\u7528\u6237\u8fdb\u884c\u5173\u8054\n    AreaId          uint           //\u5f52\u5c5e\u5730\u7684\u533a\u57df\u7f16\u53f7   \u548c\u5730\u533a\u8868\u8fdb\u884c\u5173\u8054\n    Title           string        `gorm:"size:64" `         //\u623f\u5c4b\u6807\u9898\n    Address         string        `gorm:"size:512"`         //\u5730\u5740\n    Room_count      int           `gorm:"default:1" `       //\u623f\u95f4\u6570\u76ee\n    Acreage         int           `gorm:"default:0" json:"acreage"`                   //\u623f\u5c4b\u603b\u9762\u79ef\n    Price           int           `json:"price"`\n    Unit            string        `gorm:"size:32;default:\'\'" json:"unit"`             //\u623f\u5c4b\u5355\u5143,\u5982 \u51e0\u5ba4\u51e0\u5385\n    Capacity        int           `gorm:"default:1" json:"capacity"`                   //\u623f\u5c4b\u5bb9\u7eb3\u7684\u603b\u4eba\u6570\n    Beds            string        `gorm:"size:64;default:\'\'" json:"beds"`             //\u623f\u5c4b\u5e8a\u94fa\u7684\u914d\u7f6e\n    Deposit         int           `gorm:"default:0" json:"deposit"`                   //\u62bc\u91d1\n    Min_days        int           `gorm:"default:1" json:"min_days"`                   //\u6700\u5c11\u5165\u4f4f\u7684\u5929\u6570\n    Max_days        int           `gorm:"default:0" json:"max_days"`                   //\u6700\u591a\u5165\u4f4f\u7684\u5929\u6570 0\u8868\u793a\u4e0d\u9650\u5236\n    Order_count     int           `gorm:"default:0" json:"order_count"`               //\u9884\u5b9a\u5b8c\u6210\u7684\u8be5\u623f\u5c4b\u7684\u8ba2\u5355\u6570\n    Index_image_url string        `gorm:"size:256;default:\'\'" json:"index_image_url"`            //\u623f\u5c4b\u4e3b\u56fe\u7247\u8def\u5f84\n    Facilities      []*Facility   `gorm:"many2many:house_facilities" json:"facilities"`                 //\u623f\u5c4b\u8bbe\u65bd   \u4e0e\u8bbe\u65bd\u8868\u8fdb\u884c\u5173\u8054\n    Images          []*HouseImage `json:"img_urls"`                      //\u623f\u5c4b\u7684\u56fe\u7247   \u9664\u4e3b\u8981\u56fe\u7247\u4e4b\u5916\u7684\u5176\u4ed6\u56fe\u7247\u5730\u5740\n    Orders          []*OrderHouse `json:"orders"`                        //\u623f\u5c4b\u7684\u8ba2\u5355    \u4e0e\u623f\u5c4b\u8868\u8fdb\u884c\u7ba1\u7406\n}\n\n/* \u533a\u57df\u4fe1\u606f table_name = area */  //\u533a\u57df\u4fe1\u606f\u662f\u9700\u8981\u6211\u4eec\u624b\u52a8\u6dfb\u52a0\u5230\u6570\u636e\u5e93\u4e2d\u7684\ntype Area struct {\n    Id     int      `json:"aid"`                        //\u533a\u57df\u7f16\u53f7     1    2\n    Name   string   `gorm:"size:32" json:"aname"`       //\u533a\u57df\u540d\u5b57     \u660c\u5e73 \u6d77\u6dc0\n    Houses []*House `json:"houses"` //\u533a\u57df\u6240\u6709\u7684\u623f\u5c4b   \u4e0e\u623f\u5c4b\u8868\u8fdb\u884c\u5173\u8054\n}\n\n/* \u8bbe\u65bd\u4fe1\u606f table_name = "facility"*/    //\u8bbe\u65bd\u4fe1\u606f \u9700\u8981\u6211\u4eec\u63d0\u524d\u624b\u52a8\u6dfb\u52a0\u7684\ntype Facility struct {\n    Id     int      `json:"fid"`     //\u8bbe\u65bd\u7f16\u53f7\n    Name   string   `gorm:"size:32"` //\u8bbe\u65bd\u540d\u5b57\n    Houses []*House  //\u90fd\u6709\u54ea\u4e9b\u623f\u5c4b\u6709\u6b64\u8bbe\u65bd  \u4e0e\u623f\u5c4b\u8868\u8fdb\u884c\u5173\u8054\u7684\n}\n\n/* \u623f\u5c4b\u56fe\u7247 table_name = "house_image"*/\ntype HouseImage struct {\n    Id    int    `json:"house_image_id"`         //\u56fe\u7247id\n    Url   string `gorm:"size:256" json:"url"`    //\u56fe\u7247url     \u5b58\u653e\u6211\u4eec\u623f\u5c4b\u7684\u56fe\u7247\n    HouseId uint `json:"house_id"` //\u56fe\u7247\u6240\u5c5e\u623f\u5c4b\u7f16\u53f7\n}\n\n/* \u8ba2\u5355 table_name = order */\ntype OrderHouse struct {\n    gorm.Model               //\u8ba2\u5355\u7f16\u53f7\n    UserId        uint     `json:"user_id"`  //\u4e0b\u5355\u7684\u7528\u6237\u7f16\u53f7   //\u4e0e\u7528\u6237\u8868\u8fdb\u884c\u5173\u8054\n    HouseId       uint    `json:"house_id"` //\u9884\u5b9a\u7684\u623f\u95f4\u7f16\u53f7   //\u4e0e\u623f\u5c4b\u4fe1\u606f\u8fdb\u884c\u5173\u8054\n    Begin_date  time.Time `gorm:"type:datetime"`          //\u9884\u5b9a\u7684\u8d77\u59cb\u65f6\u95f4\n    End_date    time.Time `gorm:"type:datetime"`          //\u9884\u5b9a\u7684\u7ed3\u675f\u65f6\u95f4\n    Days        int       //\u9884\u5b9a\u603b\u5929\u6570\n    House_price int       //\u623f\u5c4b\u7684\u5355\u4ef7\n    Amount      int       //\u8ba2\u5355\u603b\u91d1\u989d\n    Status      string    `gorm:"default:\'WAIT_ACCEPT\'"`   //\u8ba2\u5355\u72b6\u6001\n    Comment     string    `gorm:"size:512"`                //\u8ba2\u5355\u8bc4\u8bba\n    Credit      bool        //\u8868\u793a\u4e2a\u4eba\u5f81\u4fe1\u60c5\u51b5 true\u8868\u793a\u826f\u597d\n}\n\nfunc InitDb()(*gorm.DB,error){\n    //sql.Open()\n    db,err := gorm.Open("mysql","root:123456@tcp(127.0.0.1:3306)/test?charset=utf8")\n    defer db.Close()\n    if err == nil {\n        db.SingularTable(true)\n        db.AutoMigrate(new(User),new(House),new(Area),new(Facility),new(HouseImage),new(OrderHouse))\n        /*db.DB().SetMaxIdleConns(10)\n        db.DB().SetConnMaxLifetime(100)*/\n        return db,nil\n    }\n    return nil ,err\n}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528gorm\u6765\u521b\u5efa\u6570\u636e\u5e93\u8868")),(0,a.kt)("h4",{id:"223\u5bfc\u5165\u524d\u7aef\u9875\u9762\u5e76\u5c55\u793a"},"2.2.3\u5bfc\u5165\u524d\u7aef\u9875\u9762\u5e76\u5c55\u793a"),(0,a.kt)("p",null,"\u628a\u6211\u4eec\u7684html.zip\u62f7\u8d1d\u8fc7\u53bb\uff0c\u7136\u540e\u89e3\u538b\u5230\u5bf9\u5e94\u76ee\u5f55\u3002\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u53d1\u5177\u4f53\u4e1a\u52a1\u4e86\u3002"),(0,a.kt)("p",null,"\u7136\u540e\u4fee\u6539main.go\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport "github.com/gin-gonic/gin"\n\nfunc main(){\n    //\u521d\u59cb\u5316\u8def\u7531\n    router := gin.Default()\n\n    //\u6620\u5c04\u9759\u6001\u8d44\u6e90\n    router.Static("/home","html")\n    \n\n    //\u5f00\u542f\u76d1\u542c\n    router.Run(":8080")\n}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u8bbe\u7f6e\u9759\u6001\u8def\u5f84\u6709\u4e09\u4e2a\u65b9\u6cd5\uff0c\u5206\u522b\u662f\uff1a"),(0,a.kt)("p",{parentName:"blockquote"},"Static:\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8d44\u6e90\u8def\u5f84\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u6307\u5b9a\u7684\u6587\u4ef6\u5939,\u793a\u4f8b\uff1a"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-go"},'router.Static("/assets", "./assets")\n')),(0,a.kt)("p",{parentName:"blockquote"},"StaticFS\uff1a\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8d44\u6e90\u8def\u5f84\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662fhttp.Dir(),\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-go"},'router.StaticFS("/more_static", http.Dir("my_file_system"))\n')),(0,a.kt)("p",{parentName:"blockquote"},"StaticFile:\u4fe9\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8d44\u6e90\u8def\u5f84\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5177\u4f53\u7684\u6587\u4ef6"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},'router.StaticFile("/favicon.ico", "./resources/favicon.ico")\n'))),(0,a.kt)("p",null,"\u8fd0\u884c\u9879\u76ee\uff0c\u6253\u5f00\u6d4f\u89c8\u5668\u8f93\u5165\u7f51\u5740",(0,a.kt)("inlineCode",{parentName:"p"},"127.0.0.1:8080/home"),"\uff0c\u67e5\u770b\u9875\u9762\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565488579627",src:r(4612).Z})),(0,a.kt)("p",null,"\u6309f12\u6253\u5f00\u5f00\u53d1\u8005\u5de5\u5177\uff0c\u7136\u540e\u518d\u6b21\u5237\u65b0\u9875\u9762\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565488723410",src:r(7865).Z})),(0,a.kt)("p",null,"\u8fd9\u4e9b\u62a5\u7ea2\u7684\u9875\u9762\u5c31\u662f\u9700\u8981\u6211\u4eec\u63a5\u7740\u6765\u5b9e\u73b0\u7684\u5177\u4f53\u529f\u80fd\uff0c\u8ba9\u6211\u4eec\u5148\u4ece\u83b7\u53d6\u5730\u57df\u4fe1\u606f\u5f00\u59cb\uff01"),(0,a.kt)("h3",{id:"23\u83b7\u53d6\u5730\u57df\u4fe1\u606f"},"2.3\u83b7\u53d6\u5730\u57df\u4fe1\u606f"),(0,a.kt)("h4",{id:"231\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b"},(0,a.kt)("strong",{parentName:"h4"},"2.3.1\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'#Request:\nmethod: GET\nurl:api/v1.0/areas\n#data:\nno input data\n#Response\n#\u8fd4\u56de\u6210\u529f\uff1a\n{\n    "errno": "0",\n    "errmsg":"OK",\n    "data": [\n    {"aid": 1, "aname": "\u4e1c\u57ce\u533a"}, \n    {"aid": 2, "aname": "\u897f\u57ce\u533a"}, \n    {"aid": 3, "aname": "\u901a\u5dde\u533a"}, \n    {"aid": 4, "aname": "\u987a\u4e49\u533a"}] \n    //...\n}\n#\u6ce8\u518c\u5931\u8d25\uff1a\n{\n    "errno": "400x",   //\u72b6\u6001\u7801\n    "errmsg":"\u72b6\u6001\u9519\u8bef\u4fe1\u606f"\n}\n')),(0,a.kt)("h4",{id:"232\u4e1a\u52a1\u6d41\u7a0b\u56fe"},(0,a.kt)("strong",{parentName:"h4"},"2.3.2\u4e1a\u52a1\u6d41\u7a0b\u56fe")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565332723582",src:r(366).Z})),(0,a.kt)("h4",{id:"233\u6dfb\u52a0\u5bf9\u5e94\u8def\u7531\u548c\u4e1a\u52a1\u5904\u7406"},"2.3.3\u6dfb\u52a0\u5bf9\u5e94\u8def\u7531\u548c\u4e1a\u52a1\u5904\u7406"),(0,a.kt)("p",null,"\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"main.go"),"\u9875\u9762\u8fdb\u884c\u4fee\u6539\uff0c\u6dfb\u52a0\u5bf9\u5e94\u8def\u7531\u548c\u5904\u7406\u51fd\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'func main(){\n    //\u521d\u59cb\u5316\u8def\u7531\n    router := gin.Default()\n\n    //\u6620\u5c04\u9759\u6001\u8d44\u6e90\n    router.Static("/home","html")\n\n    //\u6dfb\u52a0\u52a8\u6001\u8def\u7531\n    r1 := router.Group("api/v1.0")\n    {\n        r1.GET("/areas",controller.GetArea)\n    }\n    \n\n    //\u5f00\u542f\u76d1\u542c\n    router.Run(":8080")\n}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5728\u4f7f\u7528gin\u5f00\u53d1\u65f6\uff0c\u4e00\u822c\u60c5\u51b5\u4f1a\u6309\u7167\u6a21\u5757\u628a\u8def\u7531\u5206\u4e3a\u4e0d\u540c\u7684\u7ec4\uff0c\u7136\u540e\u5728\u7ec4\u5185\u518d\u505a\u8def\u7531\u5339\u914d\u3002"),(0,a.kt)("p",{parentName:"blockquote"},"\u4f7f\u7528\u8def\u7531\u5339\u914d\u5bf9\u5e94\u51fd\u6570\uff0c\u51fd\u6570\u683c\u5f0f\u5fc5\u987b\u662ffunc(*gin.Context)")),(0,a.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u6765\u5b9e\u73b0\u5bf9\u5e94\u7684\u63a7\u5236\u5668\u65b9\u6cd5\uff0c\u65b9\u6cd5\u540d\u9700\u8981\u53c2\u8003\u5f00\u53d1\u6587\u6863\uff0c\u548c\u5f00\u53d1\u6587\u6863\u4fdd\u6301\u4e00\u76f4\u3002"),(0,a.kt)("h4",{id:"234\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"},"2.3.4\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"),(0,a.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u628a\u83b7\u53d6\u5730\u57df\u4fe1\u606f\u4e1a\u52a1\u653e\u5230\u670d\u52a1\u4e2d\u5b9e\u73b0\uff0c\u7136\u540e\u7528\u8fdc\u7a0b\u8c03\u7528\u3002\u9996\u5148\u6211\u4eec\u6765\u521b\u5efa\u4e00\u4e2a\u670d\u52a1\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ micro new --type srv protect/getArea\n")),(0,a.kt)("p",null,"\u7136\u540e\u53bb\u4fee\u6539proto\u6587\u4ef6\u5e76\u7f16\u8bd1\u81ea\u52a8\u751f\u6210\u7684proto\u6587\u4ef6\uff1a"),(0,a.kt)("p",null,"\u4fee\u6539\u540e\u7684proto\u6587\u4ef6\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage go.micro.srv.getArea;\n\nservice GetArea {\n    rpc Call(Request) returns (Response) {}\n}\n\nmessage Request {\n\n}\n\nmessage Response {\n    string errno = 1;\n    string errmsg = 2;\n    repeated area data = 3;\n}\n\nmessage area{\n    int32 aid = 1;\n    string aname = 2;\n}\n\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6839\u636e\u63a5\u53e3\u6587\u6863\u5b9a\u4e49\u7684\u4f20\u5165\u6570\u636e\u548c\u4f20\u51fa\u6570\u636e\u5b9a\u4e49protobuf\u683c\u5f0f\uff0c\u7136\u540e\u7f16\u8bd1proto\u6587\u4ef6")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ make proto\n")),(0,a.kt)("p",null,"\u7136\u540e\u5220\u9664\u6389main.go\u4e2d\u7684\u65e0\u7528\u4ee3\u7801\u3002\u8fdbhandler.go\u4e2d\u8fdb\u884c\u4ee3\u7801\u5b9e\u73b0\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4e1a\u52a1\u5206\u6790")),(0,a.kt)("p",null,"\u4ece\u4e1a\u52a1\u6d41\u7a0b\u56fe\u53ef\u77e5\uff0c\u6211\u4eec\u9700\u8981\u4eceredis\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u83b7\u53d6\u5230\u6570\u636e\u5c31\u628a\u6570\u636e\u901a\u8fc7json\u6253\u5305\uff0c\u4f20\u56de\u7ed9\u524d\u7aef\uff0c\u83b7\u53d6\u4e0d\u5230\u6570\u636e\uff0c\u5c31\u4ecemysql\u4e2d\u62ff\u6570\u636e\uff0c\u62ff\u5230\u6570\u636e\u4e4b\u540e\u518d\u628a\u7528json\u5e8f\u5217\u5316\u4e4b\u540e\u5b58\u5230redis\u4e2d\uff0c\u7136\u540e\u628a\u6570\u636e\u8fd4\u56de\u7ed9\u524d\u7aef\u3002"),(0,a.kt)("p",null,"\u90a3\u6211\u4eec\u9996\u5148\u4eceredis\u4e2d\u83b7\u53d6\u6570\u636e,\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u7528redis\u8fde\u63a5\u6c60\u6765\u5b9e\u73b0\u3002\u5176\u5b9e\u5728\u6211\u4eec\u8c03\u7528\u7684redis\u5305\u4e2d\u6709redis\u8fde\u63a5\u6c60\u7684\u63a5\u53e3\uff0c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0credis\u8fde\u63a5\u6c60\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'var RedisClient *redis.Pool\n\n\nfunc InitRedis(){\n    RedisClient = &redis.Pool{\n        //\u8bbe\u7f6eredis\u8fde\u63a5\u6c60\u6700\u5927\u7a7a\u95f2\u94fe\u63a5\u6570\n        MaxIdle:utils.G_redis_maxidel,\n        //\u8bbe\u7f6eredis\u8fde\u63a5\u6c60\u6700\u5927\u540c\u65f6\u94fe\u63a5\u6570\n        MaxActive:utils.G_redis_maxactive,\n        //\u8bbe\u7f6eredis\u8fde\u63a5\u6c60\u6700\u5927\u7a7a\u95f2\u65f6\u95f4\n        IdleTimeout:utils.G_redis_idletimeout,\n        //\u8fde\u63a5redis\n        Dial: func() (redis.Conn, error) {\n            conn,err :=redis.Dial("tcp",utils.G_redis_addr+utils.G_redis_port)\n            if err != nil {\n\n                return nil,err\n            }\n            //\u8bbe\u7f6e\u9009\u4e2d\u54ea\u4e2a\u6570\u636e\u5e93\n            conn.Do("select",utils.G_redis_db)\n            return conn,nil\n        },\n    }\n}\n')),(0,a.kt)("p",null,"\u4eceredis\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u8fde\u63a5redis\n    redisPool:=model.InitRedis()\n    client := redisPool.Get()\n\n    defer client.Close()\n\n    areaResp,err := redis.Bytes(client.Do("get","areas"))\n')),(0,a.kt)("p",null,"\u6821\u9a8c\u662f\u5426\u80fd\u591f\u83b7\u53d6\u5230\u6570\u636e\uff0c\u5982\u679c\u83b7\u53d6\u4e0d\u5230\uff0c\u4ecemysql\u4e2d\u83b7\u53d6\u4ee3\u7801\uff0c\u7136\u540e\u5b58\u50a8\u5230redis\u4e2d\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'    var areas []model.Area\n    if len(areaResp) == 0{\n        //\u7b2c\u4e00\u6b21\u4ecemysql\u4e2d\u83b7\u53d6\u6570\u636e \u8c03\u7528\u5c01\u88c5\u7684\u51fd\u6570\n        areas,err = model.GetAllArea()\n        if err != nil {\n            resp.Errno = utils.RECODE_DBERR\n            resp.Errmsg = utils.RecodeText(utils.RECODE_DBERR)\n            return err\n        }\n        //\u5bf9areas\u6570\u636e\u7f16\u7801\n        areaBytes ,err := json.Marshal(areas)\n        if err !=nil{\n            resp.Errno = utils.RECODE_DATAERR\n            resp.Errno = utils.RecodeText(utils.RECODE_DATAERR)\n            return err\n        }\n\n        //\u5b58\u50a8\u5230redis\u4e2d\n        _,err = redis.String(client.Do("set","areas",areaBytes))\n        if err != nil {\n            resp.Errno = utils.RECODE_DATAERR\n            resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n            return err\n        }\n    }else {\n        err = json.Unmarshal(areaResp,&areas)\n        if err != nil {\n            resp.Errno = utils.RECODE_DATAERR\n            resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n            return err\n        }\n    }\n')),(0,a.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u628amysql\u64cd\u4f5c\u5c01\u88c5\u6210\u51fd\u6570\uff0c\u653e\u5230model\u5305\u4e2d\u3002\u5177\u4f53\u5b9e\u73b0\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"func GetAllArea(db*gorm.DB)([]Area,error){\n    var areas []Area\n    err := db.Find(&areas).Error\n    if err != nil {\n        return nil,err\n    }\n    return areas,nil\n}\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"gorm\u83b7\u53d6\u6570\u636e\u65b9\u6cd5\u975e\u5e38\u591a\uff0c\u5e38\u89c1\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a"),(0,a.kt)("p",{parentName:"blockquote"},"\u83b7\u53d6\u4e00\u6761\u6570\u636e\uff1adb.First(),db.Last()"),(0,a.kt)("p",{parentName:"blockquote"},"\u83b7\u53d6\u6240\u6709\u6570\u636e\uff1adb.Find()"),(0,a.kt)("p",{parentName:"blockquote"},'\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6\uff1adb.Where("name=?","xiaohong").Find()\u6216\u8005db.Find(user,"name = ?","xiaohong")'),(0,a.kt)("p",{parentName:"blockquote"},'\u83b7\u53d6\u90e8\u5206\u5b57\u6bb5\u6570\u636e\uff1adb.Table("user").select("name","age").where("name=?","xiaohong").Scan(\u81ea\u5b9a\u4e49\u7ed3\u6784\u4f53)')),(0,a.kt)("p",null,"\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u521d\u59cb\u5316\u8fd4\u56de\u503c\n    resp.Errno = utils.RECODE_OK\n    resp.Errmsg = utils.RecodeText(utils.RECODE_OK)\n\n    //\u8fde\u63a5redis\n    redisPool:=model.InitRedis()\n    client := redisPool.Get()\n\n    defer client.Close()\n\n    areaResp,err := redis.Bytes(client.Do("get","areas"))\n\n    var areas []model.Area\n    if len(areaResp) == 0{\n        //\u7b2c\u4e00\u6b21\u4ecemysql\u4e2d\u83b7\u53d6\u6570\u636e\n        db,_ :=model.InitDb()\n        areas,err = model.GetAllArea(db)\n        if err != nil {\n            resp.Errno = utils.RECODE_DBERR\n            resp.Errmsg = utils.RecodeText(utils.RECODE_DBERR)\n            return err\n        }\n        //\u5bf9areas\u6570\u636e\u7f16\u7801\n        areaBytes ,err := json.Marshal(areas)\n        if err !=nil{\n            resp.Errno = utils.RECODE_DATAERR\n            resp.Errno = utils.RecodeText(utils.RECODE_DATAERR)\n            return err\n        }\n\n        //\u5b58\u50a8\u5230redis\u4e2d\n        _,err = redis.String(client.Do("set","areas",areaBytes))\n        if err != nil {\n            resp.Errno = utils.RECODE_DATAERR\n            resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n            return err\n        }\n    }else {\n        err = json.Unmarshal(areaResp,&areas)\n        if err != nil {\n            resp.Errno = utils.RECODE_DATAERR\n            resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n            return err\n        }\n    }\n\n    for _,v := range areas{\n        temp := getArea.Area{\n            Aid:int32(v.Id),\n            Aname:v.Name,\n        }\n        resp.Data = append(resp.Data,&temp)\n    }\n\n    return nil\n')),(0,a.kt)("h4",{id:"235web\u7aef\u56de\u8c03\u670d\u52a1\u63a5\u53e3"},"2.3.5web\u7aef\u56de\u8c03\u670d\u52a1\u63a5\u53e3"),(0,a.kt)("p",null,"\u73b0\u5728\u670d\u52a1\u63a5\u53e3\u5199\u5b8c\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5728web\u7aef\u8c03\u7528\u4e00\u4e0b\u8fd9\u4e2a\u63a5\u53e3\uff0c\u8c03\u7528\u7684\u65b9\u6cd5\u548c\u6211\u4eec\u4ee5\u524d\u7528go-micro\u65b9\u6cd5\u4e00\u6837\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'func GetArea(ctx *gin.Context){\n    //\u521d\u59cb\u5316service\n    reg := consul.NewRegistry(func(options *registry.Options) {\n        options.Addrs = []string{"127.0.0.1:8500"}\n    })\n\n    service := grpc.NewService(\n        micro.Registry(reg),\n    )\n\n    //\u83b7\u53d6\u64cd\u4f5c\u5ba2\u6237\u7aef\n    grpcClient := getArea.NewGetAreaService("go.micro.srv.getArea",service.Client())\n    //\u56de\u8c03\u51fd\u6570\n    resp ,err:= grpcClient.Call(context.TODO(),&getArea.Request{})\n    if err != nil {\n        resp.Errno = utils.RECODE_DATAERR\n        resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n    }\n\n    ctx.JSON(200,resp)\n}\n')),(0,a.kt)("p",null,"\u5f00\u542fweb\u670d\u52a1\u548c\u83b7\u53d6\u5730\u57df\u4fe1\u606f\u670d\u52a1\uff0c\u7136\u540e\u518d\u6253\u5f00\u6211\u4eec\u9875\u9762\uff0c\u70b9\u51fb\u9009\u62e9\u57ce\u533a\uff0c\u663e\u793a\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565529172641",src:r(4599).Z})),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5730\u57df\u4fe1\u606f\u5c31\u83b7\u53d6\u5230\u4e86")),(0,a.kt)("h3",{id:"24\u83b7\u53d6\u9a8c\u8bc1\u7801\u4e1a\u52a1\u5b9e\u73b0"},"2.4\u83b7\u53d6\u9a8c\u8bc1\u7801\u4e1a\u52a1\u5b9e\u73b0"),(0,a.kt)("p",null,"\u8981\u663e\u793a\u6ce8\u518c\u9875\u9762\uff0c\u9700\u8981\u5148\u628a\u6ce8\u518c\u6309\u94ae\u663e\u793a\u51fa\u6765\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u5148\u7ed9session\u8bf7\u6c42\u56de\u4e2a\u5047\u6570\u636e\uff0c\u7136\u540e\u518d\u53bb\u5b9e\u73b0\u6ce8\u518c\u76f8\u5173\u4e1a\u52a1\u3002"),(0,a.kt)("h4",{id:"241\u6a21\u62df\u56de\u590dsession\u8bf7\u6c42"},"2.4.1\u6a21\u62df\u56de\u590dsession\u8bf7\u6c42"),(0,a.kt)("p",null,"\u6839\u636e\u5f00\u53d1\u6587\u6863\u6211\u4eec\u77e5\u9053session\u7684\u8bf7\u6c42\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"api/v1.0/session"),",\u5931\u8d25\u7684\u8bdd\u8fd4\u56de\u6570\u636e\u4e3a\uff0cerrno\u548cerrmsg\u3002"),(0,a.kt)("p",null,"\u6211\u4eec\u5148\u5728web\u7aef\u7ed9\u5bf9\u5e94\u8def\u7531\u505a\u5339\u914d\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'r1.GET("/session",controller.GetSession)\n')),(0,a.kt)("p",null,"\u7136\u540e\u5728\u63a7\u5236\u5668\u4e2d\u5b9e\u73b0GetSession\u51fd\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u83b7\u53d6session\u4fe1\u606f\nfunc GetSession(ctx*gin.Context){\n    resp := make(map[string]interface{})\n\n    //\u521d\u59cb\u5316\u8fd4\u56de\u503c\n    resp["errno"] = utils.RECODE_SESSIONERR\n    resp["errmsg"] = utils.RecodeText(utils.RECODE_SESSIONERR)\n\n    //\u8fd4\u56de\u6570\u636e\n    ctx.JSON(200,resp)\n}\n')),(0,a.kt)("p",null,"\u8fd9\u65f6\u5019\u518d\u5237\u65b0\u9875\u9762\uff0c\u663e\u793a\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565531933966",src:r(4314).Z})),(0,a.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u70b9\u51fb\u6ce8\u518c\u6309\u94ae\uff0c\u663e\u793a\u6ce8\u518c\u9875\u9762\uff0c\u9875\u9762\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565531989744",src:r(9035).Z})),(0,a.kt)("h4",{id:"242\u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247"},"2.4.2\u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247"),(0,a.kt)("p",null,"\u8fdb\u5165\u6ce8\u518c\u9875\u9762\u4e4b\u540e\uff0c\u5728\u5f00\u53d1\u8005\u5de5\u5177\u4e2d\uff0c\u4f1a\u53d1\u73b0\u4e0b\u9762\u7684\u95ee\u9898\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565532096094",src:r(5138).Z})),(0,a.kt)("p",null,"\u9a8c\u8bc1\u7801\u8bf7\u6c42\u672a\u5b9e\u73b0\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u9a8c\u8bc1\u7801\u670d\u52a1\u3002\u9996\u5148\u662f\u521b\u5efa\u670d\u52a1\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ micro new --type srv project/getImageCode\n")),(0,a.kt)("p",null,"\u7136\u540e\u6839\u636e\u5f00\u53d1\u6587\u6863\u89c4\u5b9a\u7684\u8bf7\u6c42\u53c2\u6570\u548c\u8fd4\u56de\u503c\u4fee\u6539proto\u6587\u4ef6\u5e76\u7f16\u8bd1\uff0c\u4fee\u6539\u4e4b\u540e\u7684proto\u6587\u4ef6\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'syntax = "proto3";\n\npackage go.micro.srv.getImageCode;\n\nservice GetImageCode {\n    rpc Call(Request) returns (Response) {}\n}\n\nmessage Request {\n    string uuid = 1;\n}\n\nmessage Response {\n    string errno = 1;\n    string errmsg = 2;\n    string msg = 3;\n}\n')),(0,a.kt)("h4",{id:"243\u4e1a\u52a1\u6d41\u7a0b\u56fe"},"2.4.3\u4e1a\u52a1\u6d41\u7a0b\u56fe"),(0,a.kt)("p",null,(0,a.kt)("img",{src:r(9930).Z})),(0,a.kt)("h4",{id:"244\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"},"2.4.4\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"),(0,a.kt)("p",null,"\u6839\u636e\u6d41\u7a0b\u56fe\u5206\u6790\u53ef\u77e5\uff0c\u6211\u4eec\u9700\u8981\u751f\u6210\u9a8c\u8bc1\u7801\u56fe\u7247\uff0c\u7136\u540e\u628a\u9a8c\u8bc1\u7801\u56fe\u7247\u4e2d\u7684\u968f\u673a\u6570\u548c\u4f20\u5165\u7684uuid\u4e00\u8d77\u5b58\u5230redis\u4e2d\u3002\u90a3\u6211\u4eec\u5148\u6765\u770b\u770b\u56fe\u7247\u9a8c\u8bc1\u7801\u5982\u4f55\u751f\u6210\u3002\u6211\u4eec\u8fd9\u91cc\u9009\u62e9\u7684\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"github.com/afocus/captcha"),"\u6765\u5b9e\u73b0\u9a8c\u8bc1\u7801\u529f\u80fd\u3002"),(0,a.kt)("p",null,"\u8981\u4f7f\u7528\u8fd9\u4e2a\u5305\u9996\u5148\u5f53\u7136\u662f\u53bb\u4e0b\u8f7d\u8fd9\u4e2a\u5305\uff0c\u4e0b\u8f7d\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ go get -u -v github.com/afocus/captcha\n")),(0,a.kt)("p",null,"\u7136\u540e\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u8fd9\u4e2a\u5305\u7684\u4e00\u4e2a\u7b80\u5355\u793a\u4f8b\u4ee3\u7801\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'cap = captcha.New()\n// \u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u5b57\u4f53 \u6216\u4f7f\u7528cap.AddFont("xx.ttf")\u8ffd\u52a0\ncap.SetFont("comic.ttf", "xxx.ttf")\n// \u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5927\u5c0f\ncap.SetSize(128, 64)\n// \u8bbe\u7f6e\u5e72\u6270\u5f3a\u5ea6\ncap.SetDisturbance(captcha.MEDIUM)\n// \u8bbe\u7f6e\u524d\u666f\u8272 \u53ef\u4ee5\u591a\u4e2a \u968f\u673a\u66ff\u6362\u6587\u5b57\u989c\u8272 \u9ed8\u8ba4\u9ed1\u8272\ncap.SetFrontColor(color.RGBA{255, 255, 255, 255})\n// \u8bbe\u7f6e\u80cc\u666f\u8272 \u53ef\u4ee5\u591a\u4e2a \u968f\u673a\u66ff\u6362\u80cc\u666f\u8272 \u9ed8\u8ba4\u767d\u8272\ncap.SetBkgColor(color.RGBA{255, 0, 0, 255}, color.RGBA{0, 0, 255, 255}, color.RGBA{0, 153, 0, 255})\n\n//\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u4e2a\u6570\uff0c\u4ee5\u53ca\u683c\u5f0f\nimg,str := cap.Create(4,captcha.NUM)\n')),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5148\u6765\u8dd1\u4e00\u4e0b\u8fd9\u4e2a\u5305\u7ed9\u6211\u4eec\u63d0\u4f9b\u7684\u793a\u4f8b\u4ee3\u7801\uff0c\u4ee3\u7801\u8def\u5f84\u4e3a\uff1a\u4ee3\u7801\u8def\u5f84\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"github.com/afocus/captcha/examples/main.go"),",\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'    cap = captcha.New()\n\n    if err := cap.SetFont("comic.ttf"); err != nil {\n        panic(err.Error())\n    }\n\n    /*\n       //We can load font not only from localfile, but also from any []byte slice\n        fontContenrs, err := ioutil.ReadFile("comic.ttf")\n        if err != nil {\n            panic(err.Error())\n        }\n\n        err = cap.AddFontFromBytes(fontContenrs)\n        if err != nil {\n            panic(err.Error())\n        }\n    */\n\n    cap.SetSize(128, 64)\n    cap.SetDisturbance(captcha.MEDIUM)\n    cap.SetFrontColor(color.RGBA{255, 255, 255, 255})\n    cap.SetBkgColor(color.RGBA{255, 0, 0, 255}, color.RGBA{0, 0, 255, 255}, color.RGBA{0, 153, 0, 255})\n\n    http.HandleFunc("/r", func(w http.ResponseWriter, r *http.Request) {\n        img, str := cap.Create(6, captcha.ALL)\n        png.Encode(w, img)\n        println(str)\n    })\n\n    http.HandleFunc("/c", func(w http.ResponseWriter, r *http.Request) {\n        str := r.URL.RawQuery\n        img := cap.CreateCustom(str)\n        png.Encode(w, img)\n    })\n\n    http.ListenAndServe(":8086", nil)\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u4ee3\u7801\u4e2d\u5171\u6709\u4e24\u79cd\u751f\u6210\u56fe\u7247\u7684\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u751f\u6210\u5e26\u9a8c\u8bc1\u7801\u7684\u56fe\u7247\uff0c\u5e76\u8fd4\u56de\u9a8c\u8bc1\u7801\uff0c\u4e00\u79cd\u662f\u6307\u5b9a\u9a8c\u8bc1\u7801\u5185\u5bb9\uff0c\u751f\u6210\u56fe\u7247\u3002")),(0,a.kt)("p",null,"\u8fd0\u884c\u8fd9\u4e2a\u4ee3\u7801\uff0c \u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee\uff0c\u663e\u793a\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565539693333",src:r(5872).Z})),(0,a.kt)("p",null,"\u6839\u636e\u793a\u4f8b\u4ee3\u7801\uff0c\u6765\u5b9e\u73b0\u6211\u4eec\u7684\u751f\u6210\u9a8c\u8bc1\u7801\u670d\u52a1\u3002\u5177\u4f53\u5b9e\u73b0\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'    //\u83b7\u53d6\u9a8c\u8bc1\u7801\u64cd\u4f5c\u5bf9\u8c61\n    cap := captcha.New()\n\n    //\u8bbe\u7f6e\u5b57\u4f53\u5e93\n    if err := cap.SetFont("comic.ttf"); err != nil {\n        panic(err.Error())\n    }\n\n\n    //\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5c5e\u6027\n    cap.SetSize(128, 64)\n    cap.SetDisturbance(captcha.MEDIUM)\n    cap.SetFrontColor(color.RGBA{255, 255, 255, 255})\n    cap.SetBkgColor(color.RGBA{255, 0, 0, 255}, color.RGBA{0, 0, 255, 255}, color.RGBA{0, 153, 0, 255})\n\n    //\u751f\u6210\u56fe\u7247\n    img, str := cap.Create(6, captcha.ALL)\n    //\u83b7\u53d6\u5230\u9a8c\u8bc1\u7801,\u628a\u9a8c\u8bc1\u7801\u7ed3\u5408uuid\u5199\u5165redis\u4e2d\n    redisPool := model.InitRedis()\n    redisConn := redisPool.Get()\n    redisConn.Do("setex",req.Uuid,60 * 5,str)\n\n    //\u628a\u62ff\u5230\u7684\u56fe\u7247\u5bf9\u8c61\u5e8f\u5217\u5316\u6210\u5b57\u8282\u5207\u7247\u4f20\u9012\u7ed9web\n    imgBuffer,_:=json.Marshal(img)\n    rsp.Msg = imgBuffer\n')),(0,a.kt)("h4",{id:"245web\u7aef\u63a5\u6536\u6570\u636e\u5e76\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668"},"2.4.5web\u7aef\u63a5\u6536\u6570\u636e\u5e76\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668"),(0,a.kt)("p",null,"\u9996\u5148\u6211\u4eec\u73b0\u5728web\u7aef\u5bf9\u8def\u7531\u505a\u4e00\u4e2a\u5339\u914d\uff0c\u7136\u540e\u6307\u5b9a\u64cd\u4f5c\u51fd\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'r1.GET("/imagecode/:uuid",controller.GetImageCode)\n')),(0,a.kt)("p",null,"\u7136\u540e\u6211\u4eec\u6765\u5b9e\u73b0GetImageCode\u51fd\u6570\u3002\u9996\u5148\u6211\u4eec\u9700\u8981\u83b7\u53d6\u8bf7\u6c42\u4f20\u8fc7\u6765\u7684\u6570\u636e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u83b7\u53d6\u6570\u636e\nuuid := ctx.Param("uuid")\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"gin\u83b7\u53d6\u524d\u7aef\u4f20\u9012\u7684\u6570\u636e\u6709\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u5177\u4f53\u5982\u4e0b\uff1a"),(0,a.kt)("p",{parentName:"blockquote"},'\u83b7\u53d6\u8def\u5f84\u4e2d\u7684\u53c2\u6570\u4e3a\uff1actx.Param("name")'),(0,a.kt)("p",{parentName:"blockquote"},'\u83b7\u53d6get\u8bf7\u6c42\u4f20\u9012\u7684\u6570\u636e\uff0c\u65b9\u6cd5\u4e3a\uff1actx.Query("lastname") ,ctx.DefaultQuery("firstname", "Guest")'),(0,a.kt)("p",{parentName:"blockquote"},'\u83b7\u53d6post\u8bf7\u6c42\u4f20\u9012\u7684\u6570\u636e\uff0c\u65b9\u6cd5\u4e3a\uff1actx.PostForm("message"),c.DefaultPostForm("nick", "anonymous")'),(0,a.kt)("p",{parentName:"blockquote"},"\u9700\u8981\u6ce8\u610f\u7684\u662fpost\u8fd9\u79cd\u83b7\u53d6\u65b9\u6cd5\u5fc5\u987b\u662fform data\u4f20\u9012\u7684\u624d\u80fd\u83b7\u53d6\u5230\uff0c\u5982\u679c\u4f20\u9012\u7684\u6570\u636e\u662fjson\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u5bf9\u5e94\u7684\u7ed3\u6784\u4f53\uff0c\u7ed9\u6570\u636e\u8fdb\u884c\u7ed1\u5b9a\uff0c\u5177\u4f53\u64cd\u4f5c\u4e3a\uff1actx.Bind()\u6216\u8005ctx.BindJSON()")),(0,a.kt)("p",null,"\u7136\u540e\u6211\u4eec\u8c03\u7528\u670d\u52a1\uff0c\u628auuid\u4f20\u9012\u7ed9\u670d\u52a1\uff0c\u5e76\u63a5\u6536\u6570\u636e,\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u94fe\u63a5\u670d\u52a1\u5e76\u8c03\u7528\n    service := utils.GetGrpcService()\n    grpcClent := getImageCode.NewGetImageCodeService("go.micro.srv.getImageCode",service.Client())\n    resp,err:=grpcClent.Call(context.TODO(),&getImageCode.Request{\n        Uuid:uuid,\n    })\n\n    if err != nil{\n        resp.Errno = utils.RECODE_DATAERR\n        resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(500,resp)\n        return\n    }\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u6211\u4eec\u628a\u8fde\u63a5\u670d\u52a1\u7684\u4ee3\u7801\u5c01\u88c5\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\u3002")),(0,a.kt)("p",null,"\u5f97\u5230\u6570\u636e\u4e4b\u540e\u5bf9\u6570\u636e\u8fdb\u884c\u89e3\u6790\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"//\u89e3\u6790\u8fd4\u56de\u6570\u636e\u4e3aimage,\u4f20\u56de\u524d\u7aef\n    var img captcha.Image\n    json.Unmarshal(resp.Msg,&img)\n    png.Encode(ctx.Writer,img)\n")),(0,a.kt)("p",null,"\u5168\u90e8\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247\nfunc GetImageCode(ctx*gin.Context){\n    //\u83b7\u53d6\u6570\u636e\n    uuid := ctx.Param("uuid")\n\n    //\u94fe\u63a5\u670d\u52a1\u5e76\u8c03\u7528\n    service := utils.GetGrpcService()\n    grpcClent := getImageCode.NewGetImageCodeService("go.micro.srv.getImageCode",service.Client())\n    resp,err:=grpcClent.Call(context.TODO(),&getImageCode.Request{\n        Uuid:uuid,\n    })\n\n    if err != nil{\n        resp.Errno = utils.RECODE_DATAERR\n        resp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(500,resp)\n        return\n    }\n\n\n    //\u89e3\u6790\u8fd4\u56de\u6570\u636e\u4e3aimage,\u4f20\u56de\u524d\u7aef\n    var img captcha.Image\n    json.Unmarshal(resp.Msg,&img)\n    png.Encode(ctx.Writer,img)\n}\n')),(0,a.kt)("p",null,"\u8fd9\u65f6\u5019\u91cd\u542f\u9879\u76ee\uff0c\u8bbf\u95ee\u6ce8\u518c\u7ebf\u9762\uff0c\u663e\u793a\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1565542977581",src:r(5658).Z})),(0,a.kt)("h3",{id:"25\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801"},"2.5\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801"),(0,a.kt)("h4",{id:"251\u63a5\u53e3\u5b9a\u4e49"},"2.5.1\u63a5\u53e3\u5b9a\u4e49"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'#Request:\nmethod: GET\n#111\u8868\u793a\u7684\u662f\u624b\u673a\u53f7\nurl:api/v1.0/smscode/:mobile\nurl:api/v1.0/smscode/111?  text=248484&id=9cd8faa9-5653-4f7c-b653-0a58a8a98c81\ndata:no input data\n#Response\n#\u8fd4\u56de\u6210\u529f\uff1a\n{\n    "errno": "0",   //\u72b6\u6001\u7801\n    "errmsg":"ok"\n}\n#\u6ce8\u518c\u5931\u8d25\uff1a\n{\n    "errno": "4001",   //\u72b6\u6001\u7801\n    "errmsg":"\u72b6\u6001\u9519\u8bef\u4fe1\u606f"\n}\n\n')),(0,a.kt)("h4",{id:"252\u4e1a\u52a1\u6d41\u7a0b\u56fe"},"2.5.2\u4e1a\u52a1\u6d41\u7a0b\u56fe"),(0,a.kt)("p",null,(0,a.kt)("img",{src:r(5075).Z})),(0,a.kt)("h4",{id:"253\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"},"2.5.3\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"),(0,a.kt)("p",null,"\u7531\u4e1a\u52a1\u6d41\u7a0b\u56fe\u53ef\u77e5\uff0c\u524d\u7aef\u4f1a\u4f20\u9012uuid\u548c\u7535\u8bdd\u53f7\u7801\uff0c\u9996\u5148\u9700\u8981\u83b7\u53d6\u4e00\u4e0b\u9a8c\u8bc1\u7801\u8f93\u5165\u662f\u5426\u6b63\u786e\uff0c\u5982\u679c\u6b63\u786e\u5c31\u53d1\u9001\u77ed\u4fe1\uff0c\u5e76\u5bf9\u77ed\u4fe1\u5185\u5bb9\u8fdb\u884c\u7f13\u5b58\uff0c\u6210\u529f\u8fd4\u56deok\u3002\u9996\u5148\uff0c\u6211\u4eec\u5148\u6765\u521b\u5efa\u77ed\u4fe1\u670d\u52a1\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ micro new --type srv project/getSmscd\n")),(0,a.kt)("p",null,"\u7136\u540e\u6839\u636e\u8bbe\u8ba1\u6587\u6863\u4e2d\u7684\u4f20\u5165\u4f20\u51fa\u53c2\u6570\u4fee\u6539proto\u6587\u4ef6\u5e76\u7f16\u8bd1\u81ea\u52a8\u751f\u6210\u7684proto\u6587\u4ef6\uff0c\u4fee\u6539\u540e\u7684proto\u6587\u4ef6\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage go.micro.srv.getSmscd;\n\nservice GetSmscd {\n    rpc Call(Request) returns (Response) {}\n}\n\n\nmessage Request {\n    string phone = 1;\n    string text = 2;\n    string uuid = 3;\n}\n\nmessage Response {\n    string errno = 1;\n    string errmsg = 2;\n}\n')),(0,a.kt)("p",null,"\u7136\u540e\u7f16\u8bd1\u751f\u6210\u5bf9\u5e94\u63a5\u53e3\uff0c\u63a5\u7740\u4fee\u6539main.go\u6587\u4ef6\uff0c\u5177\u4f53\u7684\u548c\u4e0a\u9762\u4e24\u4e2a\u670d\u52a1\u7c7b\u4f3c\uff0c\u4e0d\u505a\u91cd\u590d\u4ecb\u7ecd\uff0c\u91cd\u70b9\u662f\u6211\u4eec\u5177\u4f53\u4e1a\u52a1\u7684\u5b9e\u73b0\u3002\u9996\u5148\u6211\u4eec\u8fd8\u662f\u8981\u5148\u9a8c\u8bc1\u56fe\u7247\u9a8c\u8bc1\u7801\u8f93\u5165\u662f\u5426\u6b63\u786e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'    //\u6821\u9a8c\u9a8c\u8bc1\u7801\u8f93\u5165\u662f\u5426\u6b63\u786e\n    redisConn := model.InitRedis().Get()\n    defer redisConn.Close()\n    code,err := redis.String(redisConn.Do("get",req.Uuid))\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n\n    if code != req.Text{\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n')),(0,a.kt)("p",null,"\u7136\u540e\u4f7f\u7528\u4f20\u8f93\u8fc7\u6765\u7684\u7535\u8bdd\u53f7\u7801\u8fdb\u884c\u77ed\u4fe1\u53d1\u9001\uff0c\u4ee3\u7801\u501f\u9274\u6211\u4eec\u54c1\u4f18\u8d2d\u7684\u77ed\u4fe1\u53d1\u9001\u4ee3\u7801\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u53d1\u9001\u77ed\u4fe1\n    //\u521d\u59cb\u5316\u5ba2\u6237\u7aef  \u9700\u8981accessKey  \u9700\u8981\u5f00\u901a\u7533\u8bf7\n    client, err := sdk.NewClientWithAccessKey("default", "LTAI01Pc2yYrheUc", "7diQBKg04TxpykIWli4VCVJUZbqmYX")\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n    //\u83b7\u53d66\u4f4d\u6570\u968f\u673a\u7801\n    rnd := rand.New(rand.NewSource(time.Now().UnixNano()))\n    vcode := fmt.Sprintf("%06d", rnd.Int31n(1000000))\n\n    //\u521d\u59cb\u5316\u8bf7\u6c42\u5bf9\u8c61\n    request := requests.NewCommonRequest()\n    request.Method = "POST"//\u8bbe\u7f6e\u8bf7\u6c42\u65b9\u6cd5\n    request.Scheme = "https" // https | http   //\u8bbe\u7f6e\u8bf7\u6c42\u534f\u8bae\n    request.Domain = "dysmsapi.aliyuncs.com"  //\u57df\u540d\n    request.Version = "2017-05-25"          //\u7248\u672c\u53f7\n    request.ApiName = "SendSms"             //api\u540d\u79f0\n    request.QueryParams["PhoneNumbers"] = req.Phone  //\u9700\u8981\u53d1\u9001\u7684\u7535\u8bdd\u53f7\u7801\n    request.QueryParams["SignName"] = "\u54c1\u4f18\u8d2d"    //\u7b7e\u540d\u540d\u79f0   \u9700\u8981\u7533\u8bf7\n    request.QueryParams["TemplateCode"] = "SMS_164275022"   //\u6a21\u677f\u53f7   \u9700\u8981\u7533\u8bf7\n    request.QueryParams["TemplateParam"] = `{"code":`+vcode+`}`   //\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\n\n    response, err := client.ProcessCommonRequest(request)  //\u53d1\u9001\u77ed\u4fe1\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n')),(0,a.kt)("p",null,"\u53d1\u9001\u6210\u529f\u4e4b\u540e\u628a\u6570\u636e\u5b58\u50a8\u5230redis\u4e2d\uff0c\u5e76\u8fd4\u56de\u7ed3\u679c\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u6821\u9a8c\u662f\u5426\u53d1\u9001\u6210\u529f,\u6210\u529f\u4e4b\u540e\u5b58\u50a8\u5230redis\u4e2d,\u5931\u8d25\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n    if response.IsSuccess(){\n        redisConn.Do("setex",req.Phone+"_code",60 * 5,vcode)\n        rsp.Errno = utils.RECODE_OK\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_OK)\n        return nil\n    }else {\n        rsp.Errno = utils.RECODE_SMSERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_SMSERR)\n        return errors.New("\u53d1\u9001\u77ed\u4fe1\u5931\u8d25")\n    }\n')),(0,a.kt)("p",null,"\u5168\u90e8\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'    //\u6821\u9a8c\u9a8c\u8bc1\u7801\u8f93\u5165\u662f\u5426\u6b63\u786e\n    redisConn := model.InitRedis().Get()\n    defer redisConn.Close()\n    code,err := redis.String(redisConn.Do("get",req.Uuid))\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n\n    if code != req.Text{\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n\n    //\u53d1\u9001\u77ed\u4fe1\n    //\u521d\u59cb\u5316\u5ba2\u6237\u7aef  \u9700\u8981accessKey  \u9700\u8981\u5f00\u901a\u7533\u8bf7\n    client, err := sdk.NewClientWithAccessKey("default", "LTAI01Pc2yYrheUc", "7diQBKg04TxpykIWli4VCVJUZbqmYX")\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n    //\u83b7\u53d66\u4f4d\u6570\u968f\u673a\u7801\n    rnd := rand.New(rand.NewSource(time.Now().UnixNano()))\n    vcode := fmt.Sprintf("%06d", rnd.Int31n(1000000))\n\n    //\u521d\u59cb\u5316\u8bf7\u6c42\u5bf9\u8c61\n    request := requests.NewCommonRequest()\n    request.Method = "POST"//\u8bbe\u7f6e\u8bf7\u6c42\u65b9\u6cd5\n    request.Scheme = "https" // https | http   //\u8bbe\u7f6e\u8bf7\u6c42\u534f\u8bae\n    request.Domain = "dysmsapi.aliyuncs.com"  //\u57df\u540d\n    request.Version = "2017-05-25"          //\u7248\u672c\u53f7\n    request.ApiName = "SendSms"             //api\u540d\u79f0\n    request.QueryParams["PhoneNumbers"] = req.Phone  //\u9700\u8981\u53d1\u9001\u7684\u7535\u8bdd\u53f7\u7801\n    request.QueryParams["SignName"] = "\u54c1\u4f18\u8d2d"    //\u7b7e\u540d\u540d\u79f0   \u9700\u8981\u7533\u8bf7\n    request.QueryParams["TemplateCode"] = "SMS_164275022"   //\u6a21\u677f\u53f7   \u9700\u8981\u7533\u8bf7\n    request.QueryParams["TemplateParam"] = `{"code":`+vcode+`}`   //\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\n\n    response, err := client.ProcessCommonRequest(request)  //\u53d1\u9001\u77ed\u4fe1\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n\n    //\u6821\u9a8c\u662f\u5426\u53d1\u9001\u6210\u529f,\u6210\u529f\u4e4b\u540e\u5b58\u50a8\u5230redis\u4e2d,\u5931\u8d25\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n    if response.IsSuccess(){\n        redisConn.Do("setex",req.Phone+"_code",60 * 5,vcode)\n        rsp.Errno = utils.RECODE_OK\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_OK)\n        return nil\n    }else {\n        rsp.Errno = utils.RECODE_SMSERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_SMSERR)\n        return errors.New("\u53d1\u9001\u77ed\u4fe1\u5931\u8d25")\n    }\n')),(0,a.kt)("h4",{id:"254web\u7aef\u5b9e\u73b0"},"2.5.4web\u7aef\u5b9e\u73b0"),(0,a.kt)("p",null,"\u540e\u53f0\u670d\u52a1\u5b9e\u73b0\u4e4b\u540e\u6211\u4eec\u63a5\u7740\u6765\u5199\u4e00\u4e0bweb\u7aef\u4ee3\u7801\uff0c\u9996\u5148\u9700\u8981\u5148\u5339\u914d\u5bf9\u5e94\u8def\u7531\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'r1.GET("/smscode/:mobile",controller.GetSmscd)\n')),(0,a.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u6765\u5b9e\u73b0\u5177\u4f53\u7684\u63a7\u5236\u5668\u51fd\u6570\u3002"),(0,a.kt)("p",null,"\u8fd8\u662f\u6211\u4eec\u7684\u56db\u6b65\u9aa4\uff0c\u5148\u83b7\u53d6\u6570\u636e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u83b7\u53d6\u6570\u636e\n    phone := ctx.Param("mobile")\n    text := ctx.Query("text")\n    uuid := ctx.Query("id")\n')),(0,a.kt)("p",null,"\u7136\u540e\u6821\u9a8c\u6570\u636e\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u6821\u9a8c\u7535\u8bdd\u53f7\u7801\u683c\u5f0f\n    reg ,_:= regexp.Compile(`^1[3,4,5,7,8]\\d{9}$`)\n    result := reg.MatchString(phone)\n    if !result{\n        resp["errno"] = utils.RECODE_MOBILEERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_MOBILEERR)\n        ctx.JSON(500,resp)\n        return\n    }\n    //\u6821\u9a8c\u6570\u636e\u4e0d\u80fd\u4e3a\u7a7a\n    if text == "" || uuid == "" {\n        resp["errno"] = utils.RECODE_DATAERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(500,resp)\n        return\n    }\n')),(0,a.kt)("p",null,"\u7136\u540e\u8fdc\u7a0b\u8c03\u7528\uff0c\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\n    grpcService := utils.GetGrpcService()\n    client := getSmscd.NewGetSmscdService("go.micro.srv.getSmscd",grpcService.Client())\n    rsp,err:= client.Call(context.TODO(),&getSmscd.Request{\n        Text:text,\n        Uuid:uuid,\n        Phone:phone,\n    })\n\n    if err != nil {\n        fmt.Println(err)\n        resp["errno"] = utils.RECODE_SMSERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_SMSERR)\n        ctx.JSON(500,resp)\n        return\n    }\n')),(0,a.kt)("h3",{id:"26\u53d1\u9001\u6ce8\u518c\u4fe1\u606f\u670d\u52a1"},"2.6\u53d1\u9001\u6ce8\u518c\u4fe1\u606f\u670d\u52a1"),(0,a.kt)("h4",{id:"261\u63a5\u53e3\u5b9a\u4e49"},"2.6.1\u63a5\u53e3\u5b9a\u4e49"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'#Request:\nmethod: POST\nurl:api/v1.0/users\n#data:\n{\n    mobile: "123", //\u624b\u673a\u53f7\n    password: "123", //\u5bc6\u7801\n    sms_code: "123"   //\u77ed\u4fe1\u9a8c\u8bc1\u7801\n}\n#Response\n#\u8fd4\u56de\u6210\u529f\uff1a\n{\n    "errno": "0",   //\u72b6\u6001\u7801\n    "errmsg":"ok"\n}\n#\u6ce8\u518c\u5931\u8d25\uff1a\n{\n    "errno": "4001",   //\u72b6\u6001\u7801\n    "errmsg":"\u72b6\u6001\u9519\u8bef\u4fe1\u606f"\n}\n')),(0,a.kt)("h4",{id:"262\u4e1a\u52a1\u6d41\u7a0b\u56fe"},"2.6.2\u4e1a\u52a1\u6d41\u7a0b\u56fe"),(0,a.kt)("p",null,(0,a.kt)("img",{src:r(2614).Z})),(0,a.kt)("h4",{id:"263\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"},"2.6.3\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0"),(0,a.kt)("p",null,"\u521b\u5efa\u670d\u52a1\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ micro new --type srv project/postRet\n")),(0,a.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u4fee\u6539proto\u6587\u4ef6\u5e76\u7f16\u8bd1\uff0c\u4fee\u6539\u540e\u7684proto\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage go.micro.srv.postRet;\n\nservice PostRet {\n    rpc Call(Request) returns (Response) {}\n}\n\nmessage Request {\n    string mobile = 1;\n    string password = 2;\n    string sms_code = 3;\n}\n\nmessage Response {\n    string errno = 1;\n    string errmsg = 2;\n}\n')),(0,a.kt)("p",null,"\u5177\u4f53\u7684\u4e1a\u52a1\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u4eceredis\u4e2d\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\n    redisConn := model.InitRedis().Get()\n    code,err := redis.String(redisConn.Do("get",req.Mobile+"_code"))\n    if err != nil {\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return err\n    }\n    //\u6821\u9a8c\u9a8c\u8bc1\u7801\u662f\u5426\u6b63\u786e\n    if code != req.SmsCode{\n        rsp.Errno = utils.RECODE_DATAERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DATAERR)\n        return errors.New("\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e")\n    }\n\n    //\u628a\u7528\u6237\u6570\u636e\u63d2\u5165\u5230mysql\u4e2d\n    db,err := model.InitDb()\n    if err != nil {\n        rsp.Errno = utils.RECODE_DBERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DBERR)\n        return errors.New("\u6570\u636e\u5e93\u8fde\u63a5\u9519\u8bef")\n    }\n    var user model.User\n    user.Name = req.Mobile\n    user.Mobile = req.Mobile\n\n    //\u5bf9\u5bc6\u7801\u505amd5\u52a0\u5bc6\n    m5 := md5.New()\n    m5.Write([]byte(req.Password))\n    m5Pwd := hex.EncodeToString(m5.Sum(nil))\n\n    user.Password_hash = m5Pwd\n    err = db.Create(&user).Error\n    if err != nil {\n        rsp.Errno = utils.RECODE_DBERR\n        rsp.Errmsg = utils.RecodeText(utils.RECODE_DBERR)\n        return err\n    }\n')),(0,a.kt)("h4",{id:"264session\u4e2d\u95f4\u4ef6\u4f7f\u7528"},"2.6.4session\u4e2d\u95f4\u4ef6\u4f7f\u7528"),(0,a.kt)("p",null,"\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e0bgin\u4e2d\u95f4\u4ef6\u5177\u4f53\u662f\u4ec0\u4e48\uff1f\u5176\u5b9egin\u4e2d\u95f4\u4ef6\u529f\u80fd\u5f88\u7c7b\u4f3c\u6211\u4eecbeego\u4e2d\u7684\u8def\u7531\u8fc7\u6ee4\u5668\u3002\u4e0d\u8fc7\u529f\u80fd\u66f4\u5f3a\u5927\u3002\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6\u7684\u7b80\u5355\u793a\u4f8b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'func Logger() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        t := time.Now()\n        // \u5728\u8def\u7531\u4e4b\u524d\u8c03\u7528\u4e0a\u9762\u4ee3\u7801\n        c.Next()\n        //\u5728\u8def\u7531\u4e4b\u540e\u8c03\u7528\n        latency := time.Since(t)\n        fmt.Println(latency)\n    }\n}\nfunc main() {\n    r := gin.Default()\n    r.Use(Logger())\n\n    r.GET("/test", func(c *gin.Context) {\n            c.Writer.Write([]byte("hello world"))\n    })\n\n    r.Run(":8080")\n}\n')),(0,a.kt)("p",null,"\u9664\u4e86\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6\uff0cgin\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6846\u67b6\u4e2d\u95f4\u4ef6\uff0c\u5730\u5740\u4e3a\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/gin-contrib/"},"https://github.com/gin-contrib/")),(0,a.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u4f7f\u7528session\u3002\u9996\u5148\u6211\u4eec\u9700\u8981\u4e0b\u8f7dsession\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ go get -u -v github.com/gin-contrib/sessions\n")),(0,a.kt)("p",null,"\u7136\u540e\u6211\u4eec\u6765\u770b\u4e00\u4e0bsessions\u7684\u7b80\u5355\u4f7f\u7528\u3002\u9996\u5148\u662f\u505asession\u7684\u521d\u59cb\u5316\uff0c\u4e3b\u8981\u662f\u505asession\u5bb9\u5668\u7684\u8bbe\u7f6e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'store, _ := redis.NewStore(10, "tcp", "localhost:6379", "", []byte("secret"))\nrouter.Use(sessions.Sessions("mysession", store))\n')),(0,a.kt)("p",null,"\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0b\u9762\u7684\u8def\u7531\u4e2d\u53bb\u4f7f\u7528\u76f8\u5e94\u7684sessions\u64cd\u4f5c\u4e86\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'s := sessions.Default(ctx)\n    s.Set("name","itcast")\n    name := s.Get("name")\n    s.Delete("name")\n\n')),(0,a.kt)("p",null,"\u4f46\u662f\u5927\u5bb6\u8fd9\u65f6\u5019\u53d1\u73b0\uff0c\u5728\u670d\u52a1\u4e2d\u6211\u4eec\u5e76\u6ca1\u6709\u4f7f\u7528gin\u7684\u8def\u7531\uff0c\u4e5f\u6ca1\u6709\u5bf9\u5e94\u7684gin.Context,\u6240\u4ee5\u5728\u670d\u52a1\u4e2d\u5b9e\u73b0session\u7684\u6dfb\u52a0\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u53ef\u4ee5\u628asession\u64cd\u4f5c\u653e\u5728web\u7aef\u6765\u5904\u7406\uff0c\u5177\u4f53\u64cd\u4f5c\u6211\u4eec\u63a5\u7740\u5f80\u4e0b\u770b\u3002"),(0,a.kt)("h4",{id:"265web\u7aef\u5b9e\u73b0"},"2.6.5web\u7aef\u5b9e\u73b0"),(0,a.kt)("p",null,"\u9996\u5148\u662f\u505a\u8def\u7531\u5339\u914d\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'r1.POST("/users",controller.PostRet)\n')),(0,a.kt)("p",null,"\u6709\u8bf7\u6c42\u4e4b\u540e\uff0c\u63a5\u7740\u6211\u4eec\u53bb\u5b9e\u73b0\u5bf9\u5e94\u63a7\u5236\u5668\u65b9\u6cd5\u3002\u9996\u5148\u662f\u83b7\u53d6\u6570\u636e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u786e\u5b9a\u5bb9\u5668\n    resp := make(map[string]interface{})\n    //\u7ed1\u5b9a\u6570\u636e\n    var regUser RegisterUser\n    err := ctx.Bind(&regUser)\n    if err != nil {\n        resp["errno"] = utils.RECODE_DATAERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(200,resp)\n        return\n    }\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u9762\u9700\u8981\u6ce8\u610f\uff0cgin\u91cc\u9762\u83b7\u53d6post\u4e0a\u4f20\u7684formdata\u6570\u636e\u4f7f\u7528postForm\uff0c\u4f46\u662f\u5982\u679c\u83b7\u53d6json\u683c\u5f0f\u6570\u636e\uff0c\u9700\u8981\u53bb\u7ed1\u5b9a\u5bf9\u5e94\u7ed3\u6784\u4f53\uff0c\u6240\u4ee5\u8fd9\u91cc\u9762\u6211\u4eec\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a\u548cjson\u6570\u636e\u5bf9\u5e94\u7684\u7ed3\u6784\u4f53,\u7ed3\u6784\u4f53\u7ed3\u6784\u5982\u4e0b\uff1a")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'type RegisterUser struct {\n    Mobile string `json:"mobile"`\n    Password string  `json:"password"`\n    SmsCode string    `json:"sms_code"`\n}\n')),(0,a.kt)("p",null,"\u8fd9\u6837\u6211\u4eec\u4e45\u80fd\u83b7\u53d6\u6570\u636e\u4e86\uff0c\u7136\u540e\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u6821\u9a8c\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u6821\u9a8c\u6570\u636e\n    if regUser.Mobile == "" || regUser.Password == "" || regUser.SmsCode == ""{\n        resp["errno"] = utils.RECODE_DATAERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(200,resp)\n        return\n    }\n\n    reg,_ := regexp.Compile(`^1[3,4,5,7,8]\\d{9}$`)\n    if !reg.MatchString(regUser.Mobile){\n        resp["errno"] = utils.RECODE_DATAERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(200,resp)\n        return\n    }\n')),(0,a.kt)("p",null,"\u7136\u540e\u8fdb\u884c\u8fdc\u7a0b\u670d\u52a1\u8c03\u7528\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'//\u8fdc\u7a0b\u8c03\u7528\n    grpcService := utils.GetGrpcService()\n    grpcClient := postRet.NewPostRetService("go.micro.srv.postRet",grpcService.Client())\n    respData,err := grpcClient.Call(context.TODO(),&postRet.Request{Mobile:regUser.Mobile,Password:regUser.Password,SmsCode:regUser.SmsCode})\n    if err != nil {\n        resp["errno"] = utils.RECODE_DATAERR\n        resp["errmsg"] = utils.RecodeText(utils.RECODE_DATAERR)\n        ctx.JSON(200,resp)\n        return\n    }\n')),(0,a.kt)("p",null,"\u6839\u636e\u8fd4\u56de\u503c\uff0c\u8bbe\u7f6esession\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'    if respData.Errno == utils.RECODE_OK{\n        s := sessions.Default(ctx)\n        s.Set("userName",regUser.Mobile)\n        s.Save()\n    }\n')))}m.isMDXComponent=!0},9930:function(e,n,r){n.Z=r.p+"assets/images/1542885416102-653025b44cf4be47379c533ccf6c8de5.png"},5075:function(e,n,r){n.Z=r.p+"assets/images/1542886924797-2acf2f5edd3d291d7bbb1d20390e8ae5.png"},6245:function(e,n,r){n.Z=r.p+"assets/images/1565331217181-816d4d7276a58849a50309c1b9a6c678.png"},366:function(e,n,r){n.Z=r.p+"assets/images/1565332723582-4438674a6f941944e9e92871ce196f0b.png"},4612:function(e,n,r){n.Z=r.p+"assets/images/1565488579627-12a25e7f4de28c3aee13ca8bffbfde82.png"},7865:function(e,n,r){n.Z=r.p+"assets/images/1565488723410-ba0e41c9353c94d5e7b7be7dc09d411f.png"},4599:function(e,n,r){n.Z=r.p+"assets/images/1565529172641-b1fc908b6bb5e4fad142a4572552d9a2.png"},4314:function(e,n,r){n.Z=r.p+"assets/images/1565531933966-f765606f42c8c012894e4b253aef0643.png"},9035:function(e,n,r){n.Z=r.p+"assets/images/1565531989744-8207e96cd3c521ec1aa4d77e9ab5bfd6.png"},5138:function(e,n,r){n.Z=r.p+"assets/images/1565532096094-2a4a26aecb88986e49e3024b226f13a6.png"},5872:function(e,n,r){n.Z=r.p+"assets/images/1565539693333-26b4058eb35f3b476cbb2df3c734a105.png"},5658:function(e,n,r){n.Z=r.p+"assets/images/1565542977581-82aceaf1efd8f99dcf7c9955f7694b03.png"},2614:function(e,n,r){n.Z=r.p+"assets/images/clip_image002-d63155b82f5c5924f4d04a8f95cd447d.jpg"}}]);
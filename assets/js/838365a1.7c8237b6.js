"use strict";(self.webpackChunkleix_wang_website=self.webpackChunkleix_wang_website||[]).push([[759],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return k}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),c=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},s=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),s=c(n),k=a,g=s["".concat(p,".").concat(k)]||s[k]||u[k]||l;return n?r.createElement(g,i(i({ref:t},m),{},{components:n})):r.createElement(g,i({ref:t},m))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,i=new Array(l);i[0]=s;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var c=2;c<l;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}s.displayName="MDXCreateElement"},6889:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return m},default:function(){return s}});var r=n(7462),a=n(3366),l=(n(7294),n(3905)),i=["components"],o={sidebar_position:3},p="Redis \u6570\u636e\u5e93",c={unversionedId:"golang/redis",id:"golang/redis",title:"Redis \u6570\u636e\u5e93",description:"Redis \u57fa\u672c\u4f7f\u7528",source:"@site/docs/01.golang/03.redis.md",sourceDirName:"01.golang",slug:"/golang/redis",permalink:"/docs/golang/redis",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"ORM \u6846\u67b6",permalink:"/docs/golang/mysql"},next:{title:"Session\u529f\u80fd\u5b9e\u73b0",permalink:"/docs/golang/session"}},m=[{value:"Redis \u57fa\u672c\u4f7f\u7528",id:"redis-\u57fa\u672c\u4f7f\u7528",children:[],level:2},{value:"go\u8bed\u8a00\u64cd\u4f5c Redis",id:"go\u8bed\u8a00\u64cd\u4f5c-redis",children:[{value:"RedisLab",id:"redislab",children:[],level:4}],level:2},{value:"Redis \u5b58\u50a8\u56fe\u7247\u9a8c\u8bc1\u7801\u7684 uuid \u548c\u7801\u503c",id:"redis-\u5b58\u50a8\u56fe\u7247\u9a8c\u8bc1\u7801\u7684-uuid-\u548c\u7801\u503c",children:[{value:"\u5fae\u670d\u52a1\u7aef",id:"\u5fae\u670d\u52a1\u7aef",children:[],level:4},{value:"\u5f00\u53d1\u8005\u5e73\u53f0",id:"\u5f00\u53d1\u8005\u5e73\u53f0",children:[{value:"\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7",id:"\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7",children:[],level:4}],level:3}],level:2},{value:"\u83b7\u53d6 \u6ce8\u518c\u9875\u9762 \u56fe\u7247\u9a8c\u8bc1\u7801ID",id:"\u83b7\u53d6-\u6ce8\u518c\u9875\u9762-\u56fe\u7247\u9a8c\u8bc1\u7801id",children:[],level:2},{value:"\u56fe\u7247\u9a8c\u8bc1\u7801\u83b7\u53d6",id:"\u56fe\u7247\u9a8c\u8bc1\u7801\u83b7\u53d6",children:[],level:2},{value:"\u56fe\u7247\u9a8c\u8bc1\u7801\u6a21\u5757\u96c6\u6210\u5230web",id:"\u56fe\u7247\u9a8c\u8bc1\u7801\u6a21\u5757\u96c6\u6210\u5230web",children:[],level:2},{value:"\u5fae\u670d\u52a1\u5b9e\u73b0 \u56fe\u7247\u9a8c\u8bc1\u7801",id:"\u5fae\u670d\u52a1\u5b9e\u73b0-\u56fe\u7247\u9a8c\u8bc1\u7801",children:[],level:2},{value:"web\u7aef\u5bf9\u63a5\u5fae\u670d\u52a1\u5b9e\u73b0",id:"web\u7aef\u5bf9\u63a5\u5fae\u670d\u52a1\u5b9e\u73b0",children:[],level:2},{value:"\u8fde\u63a5\u5f62\u5f0f",id:"\u8fde\u63a5\u5f62\u5f0f",children:[],level:2}],u={toc:m};function s(e){var t=e.components,n=(0,a.Z)(e,i);return(0,l.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"redis-\u6570\u636e\u5e93"},"Redis \u6570\u636e\u5e93"),(0,l.kt)("h2",{id:"redis-\u57fa\u672c\u4f7f\u7528"},"Redis \u57fa\u672c\u4f7f\u7528"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4fee\u6539 \u914d\u7f6e\u6587\u4ef6\u3002 /etc/redis/redis.conf . ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"bind \u5730\u5740\u3002\u4fee\u6539\u6210\u5f53\u524d\u4e3b\u673a\u5730\u5740\u3002 \u2014\u2014 192.168.6.108 "))),(0,l.kt)("li",{parentName:"ol"},"port\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"6379"))),(0,l.kt)("li",{parentName:"ol"},"\u5f00\u542f redis\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"sudo  redis-server  /etc/redis/redis.conf"),(0,l.kt)("li",{parentName:"ul"},"\u9a8c\u8bc1 \uff1a ps xua | grep redis  \u2014\u2014 iP \u548c port"))),(0,l.kt)("li",{parentName:"ol"},"\u8fde\u63a5 redis \uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"redis-cli -h 192.168.6.108 -p 6379"))),(0,l.kt)("li",{parentName:"ol"},"\u67e5\u770b\u6240\u6709\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"keys *"))),(0,l.kt)("li",{parentName:"ol"},"\u5220\u9664\u6240\u6709\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"flushall"))),(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u4e00\u6761\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"set key  value  \u2014\u2014   set  hello  world"))),(0,l.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u4e00\u6761\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"get key ")))),(0,l.kt)("h2",{id:"go\u8bed\u8a00\u64cd\u4f5c-redis"},"go\u8bed\u8a00\u64cd\u4f5c Redis"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4ece redis.cn \u2014\u2014 \u5ba2\u6237\u7aef \u2014\u2014 go\u8bed\u8a00 \u2014\u2014 \u9009\u62e9 redigo \u2014\u2014 ",(0,l.kt)("a",{parentName:"p",href:"https://godoc.org/github.com/gomodule/redigo/redis#pkg-examples"},"https://godoc.org/github.com/gomodule/redigo/redis#pkg-examples"),"  \u67e5\u770b API")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e3b\u8981\u5206\u4e3a 3 \u7c7b\uff1a"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u8fde\u63a5\u6570\u636e\u5e93\u3002   ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"API\u6587\u6863\u4e2d\uff0c\u6240\u6709\u4ee5 Dial \u5f00\u5934\u3002"))),(0,l.kt)("li",{parentName:"ol"},"\u64cd\u4f5c\u6570\u636e\u5e93\u3002   ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Do() \u51fd\u6570\u3010\u63a8\u8350\u3011;  Send()\u51fd\u6570, \u9700\u8981\u914d\u5408Flush()\u3001Receive() 3 \u4e2a\u51fd\u6570\u4f7f\u7528\u3002"))),(0,l.kt)("li",{parentName:"ol"},"\u56de\u590d\u52a9\u624b\u3002   ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u76f8\u5f53\u4e8e \u201c\u7c7b\u578b\u65ad\u8a00\u201d\u3002\u6839\u636e\u4f7f\u7528\u7684\u5177\u4f53\u6570\u636e\u7c7b\u578b\uff0c\u9009\u62e9\u8c03\u7528\u3002"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6dfb\u52a0\u6d4b\u8bd5\u6848\u4f8b\uff1a"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "github.com/gomodule/redigo/redis"\n    "fmt"\n)\n\nfunc main()  {\n    // 1. \u94fe\u63a5\u6570\u636e\u5e93\n    conn, err := redis.Dial("tcp", "192.168.6.108:6379")\n    if err != nil {\n        fmt.Println("redis Dial err:", err)\n        return\n    }\n    defer conn.Close()\n\n    // 2. \u64cd\u4f5c\u6570\u636e\u5e93\n    reply, err := conn.Do("set", "itcast", "itheima")\n\n    // 3. \u56de\u590d\u52a9\u624b\u7c7b\u51fd\u6570. ---- \u786e\u5b9a\u6210\u5177\u4f53\u7684\u6570\u636e\u7c7b\u578b\n    r, e := redis.String(reply, err)\n\n    fmt.Println(r, e)\n}\n')),(0,l.kt)("h4",{id:"redislab"},"RedisLab"),(0,l.kt)("p",null,"\u4f7f\u7528\u514d\u8d39\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"RedisLab"),"\u8fde\u63a5\u65b9\u6cd5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "github.com/gomodule/redigo/redis"\n)\n\nfunc main() {\n    // 1. \u94fe\u63a5\u6570\u636e\u5e93\n    conn, err := redis.Dial("tcp", "redis-11014.c53.west-us.azure.cloud.redislabs.com:11014")\n    defer conn.Close()\n    if err != nil {\n        fmt.Println("redis Dial err:", err)\n        return\n    }\n  // 2 \u8f93\u5165\u5bc6\u7801\u8fdb\u884c\u9a8c\u8bc1\n    err = conn.Send("auth", "SxerFQeNxzsiclXGUDbAoLGY9M5tE3gz")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    // 3. \u5199\u5165\u6570\u636e\u7684\u64cd\u4f5c\n  reply, err := redis.String(conn.Do("set", "itcast", "itheima"))\n    fmt.Println(reply, err)\n  if err != nil {\n        fmt.Println(err)\n        return\n    }\n  // 4. \u8bfb\u53d6\u6570\u636e\u7684\u64cd\u4f5c\n  it, err := redis.String(conn.Do("get", "itcast"))\n    fmt.Println("1", it, err)\n  if err != nil {\n        fmt.Println(err)\n        return\n    }\n}\n\n')),(0,l.kt)("h2",{id:"redis-\u5b58\u50a8\u56fe\u7247\u9a8c\u8bc1\u7801\u7684-uuid-\u548c\u7801\u503c"},"Redis \u5b58\u50a8\u56fe\u7247\u9a8c\u8bc1\u7801\u7684 uuid \u548c\u7801\u503c"),(0,l.kt)("h4",{id:"\u5fae\u670d\u52a1\u7aef"},"\u5fae\u670d\u52a1\u7aef"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4fee\u6539 service/proto \u4e2d getCaptcha.proto \u7684 Request \u6d88\u606f\u4f53\uff0c\u586b\u52a0 uuid \u6210\u5458\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'message Request {\n    string uuid = 1;\n}\n    ```\n2.  \u4f7f\u7528 make \u547d\u4ee4\uff0c\u91cd\u65b0\u751f\u6210 getCaptcha.proto \u5bf9\u5e94\u7684\u6587\u4ef6\u3002\n3.  \u9075\u5faa MVC \u4ee3\u7801\u7ec4\u7ec7\u67b6\u6784\uff0c\u5728 service/getCaptcha/ \u4e2d \u521b\u5efa model \u76ee\u5f55\n4.  \u521b\u5efa modelFunc.go \u6587\u4ef6 \u5c01\u88c5\u5e76\u5b9e\u73b0 SaveImgCode() \u51fd\u6570\uff1a\n```go\n// \u5b58\u50a8\u56fe\u7247id \u5230redis \u6570\u636e\u5e93\nfunc SaveImgCode(code, uuid string) error {\n    // 1. \u94fe\u63a5\u6570\u636e\u5e93\n    conn, err := redis.Dial("tcp", "192.168.6.108:6379")\n    if err != nil {\n        fmt.Println("redis Dial err:", err)\n        return err\n    }\n    defer conn.Close()\n\n    // 2. \u5199\u6570\u636e\u5e93  --- \u6709\u6548\u65f6\u95f4 5 \u5206\u949f\n    _, err = conn.Do("setex", uuid, 60*5, code)\n\n    return err  // \u4e0d\u9700\u8981\u56de\u590d\u52a9\u624b!\n}\n    ```\n5.  \u5728 getCaptcha.go \u6587\u4ef6\u7684 Call() \u65b9\u6cd5\u4e2d\uff0c cap.Create() \u540e\uff0c \u8c03\u7528 SaveImgCode() \u4f20\u53c2\u3002\n\n        \n\n#### web\u7aef\n\n    1.  \u4fee\u6539\u5bc6\u7801\u672c\uff01\u56e0\u4e3a \u5fae\u670d\u52a1\u7aef \u4fee\u6539\u4e86 proto/  , \u6dfb\u52a0\u6d88\u606f\u4f53\u6210\u5458\u3002 \u9700\u8981\u91cd\u65b0\u62f7\u8d1d proto/ \u5230web\n\n    2.   \u4fee\u6539 web/controller/user.go \u4e2d Call() \u65b9\u6cd5\u4f20\u53c2\u3002\u7ed9 Request{} \u521d\u59cb\u5316\u3002\n\n```go\nresp, err := microClient.Call(context.TODO(), &getCaptcha.Request{Uuid:uuid})\nif err != nil {\n    fmt.Println("\u672a\u627e\u5230\u8fdc\u7a0b\u670d\u52a1...")\n    return\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"3. \u6d4b\u8bd5\u9a8c\u8bc1\uff1a\n    1. \u786e\u8ba4 consul \u5df2\u7ecf\u542f\u52a8 \n    2. \u542f\u52a8 service/    main.go \n    3. \u542f\u52a8 web/   main.go\n    4. \u6d4f\u89c8\u5668\uff1a192.168.6.108:8080/home  --- \u70b9\u51fb\u201c\u6ce8\u518c\u201d\u3002\u770b\u5230 \u56fe\u7247\u9a8c\u8bc1\u7801\u3002\n    5. \u67e5\u770b redis \u6570\u636e\u5e93\uff0c keys * \u80fd\u770b\u5230 \u56fe\u7247\u9a8c\u8bc1\u5417\uff0c\u5bf9\u5e94 uuid\u3002 \u6821\u9a8c\uff01\uff01\n")),(0,l.kt)("h3",{id:"\u5f00\u53d1\u8005\u5e73\u53f0"},"\u5f00\u53d1\u8005\u5e73\u53f0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e2d\u56fd\u79fb\u52a8 \u2014\u2014 \u77ed\u4fe1\u9a8c\u8bc1\u7801 \u4e1a\u52a1 \u2014\u2014 \u4e0b\u653e\u5230\u5404\u4e2a\u5927\u516c\u53f8\uff08\u8d44\u8d28\uff09\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5e38\u7528\u5e73\u53f0\uff1a"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u805a\u5408\u6570\u636e\uff1a"),(0,l.kt)("li",{parentName:"ol"},"\u4eac\u4e1c\u4e07\u8c61\uff1a"),(0,l.kt)("li",{parentName:"ol"},"\u817e\u8baf\u4e91\uff1a"),(0,l.kt)("li",{parentName:"ol"},"\u963f\u91cc\u4e91\uff08\u63a8\u8350\uff09\uff1a \u63a8\u8350\uff0c\u670d\u52a1\u5668\u3002\u2014\u2014 \u751f\u6001\u597d\uff01 API\u63a5\u53e3\u4e30\u5bcc\u3002 \u5bf9\u5e94\u5f00\u53d1\u53cb\u597d\u5ea6\u9ad8\uff01"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8d44\u6599\u641c\u7d22\u3002"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u514d\u8d39\uff1a\u2014\u2014 github "),(0,l.kt)("li",{parentName:"ul"},"\u6536\u8d39\uff1a\u2014\u2014 \u5404\u79cd\u5f00\u53d1\u8005\u5e73\u53f0\u3002\u5201\u94bb\u3001\u751f\u50fb\u9886\u57df\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6700\u540eGoogle\u3002")))),(0,l.kt)("h4",{id:"\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7"},"\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u5b9e\u540d\u8ba4\u8bc1"),(0,l.kt)("li",{parentName:"ol"},"\u5f00\u901a\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd \u2014\u2014 \u5145\u503c 2 \u5143\u5de6\u53f3\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7533\u8bf7 AccessKey"),(0,l.kt)("li",{parentName:"ol"},"\u7533\u8bf7\u7b7e\u540d\u3002\u56fd\u5185\u6d88\u606f \u2014\u2014 \u7b7e\u540d\u7ba1\u7406"),(0,l.kt)("li",{parentName:"ol"},"\u7533\u8bf7\u6a21\u677f\u3002\u56fd\u5185\u6d88\u606f \u2014\u2014 \u6a21\u677f\u7ba1\u7406"),(0,l.kt)("li",{parentName:"ol"},"\u6d4b\u8bd5\u4f7f\u7528  OpenAPI Explorer\uff0c \u6210\u529f\u53d1\u9001\u4e00\u6761\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff01")),(0,l.kt)("h1",{id:"\u56fe\u7247\u9a8c\u8bc1\u7801"},"\u56fe\u7247\u9a8c\u8bc1\u7801"),(0,l.kt)("h2",{id:"\u83b7\u53d6-\u6ce8\u518c\u9875\u9762-\u56fe\u7247\u9a8c\u8bc1\u7801id"},"\u83b7\u53d6 \u6ce8\u518c\u9875\u9762 \u56fe\u7247\u9a8c\u8bc1\u7801ID"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u542f\u52a8 web\u9875\u9762\uff0c\u70b9\u51fb\u201c\u6ce8\u518c\u201d \u6309\u94ae\u3002\u5728 NetWork \u2014\u2014 Headers \u4e2d \u770b\u5230 \u9519\u8bef\u4fe1\u606f\uff01")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4ece URL\u4e2d\uff0c\u63d0\u53d6 \u56fe\u7247\u9a8c\u8bc1\u7801ID \u3002 \u4fdd\u5b58 \u6210 uuid")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b gin \u6846\u67b6 \u4e2d\u6587\u6587\u6863\u3002\u2014\u2014 \u201c\u83b7\u53d6\u8def\u5f84\u4e2d\u7684\u53c2\u6570\u201d")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"web/main.go \u4e2d \u6dfb\u52a0 \u8def\u7531\u5339\u914d\uff1a"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'router.GET("/api/v1.0/imagecode/:uuid", controller.GetImageCd)\n')),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},"web/controller/user.go \u4e2d \uff0c\u5b9e\u73b0\u56de\u8c03\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u83b7\u53d6\u56fe\u7247\u4fe1\u606f\nfunc GetImageCd(ctx *gin.Context) {\n    uuid := ctx.Param("uuid")\n    fmt.Println("uuid = ", uuid)\n}\n')),(0,l.kt)("h2",{id:"\u56fe\u7247\u9a8c\u8bc1\u7801\u83b7\u53d6"},"\u56fe\u7247\u9a8c\u8bc1\u7801\u83b7\u53d6"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53bb github \u4e2d\u641c\u7d22 \u201ccaptcha\u201d \u5173\u952e\u8bcd\u3002 \u8fc7\u6ee4 Go\u8bed\u8a00\u3002 \u2014\u2014  ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/afocus/captcha"},"afocus/",(0,l.kt)("em",{parentName:"a"},"captcha")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528 go get github.com/afocus/captcha \u4e0b\u8f7d\u6e90\u7801\u5305\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u53c2\u7167 github \u4e2d\u7684\u793a\u4f8b\u4ee3\u7801\uff0c\u6d4b\u8bd5\u751f\u6210 \u56fe\u7247\u9a8c\u8bc1\u7801\uff1a"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "github.com/afocus/captcha"   // \u6309\u4f4f Ctrl \uff0c\u9f20\u6807\u5de6\u952e\u70b9\u51fb captcha \u770b\u5230 examples\uff0c \u4ece\u4e2d\u53ef\u63d0\u53d6\u5230 \u201ccomic.ttf\u201d\n    "image/color"\n    "image/png"\n    "net/http"\n)\n\nfunc main()  {\n    // \u521d\u59cb\u5316\u5bf9\u8c61\n    cap := captcha.New()\n\n    // \u8bbe\u7f6e\u5b57\u4f53\n    cap.SetFont("comic.ttf")\n\n    // \u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5927\u5c0f\n    cap.SetSize(128, 64)\n\n    // \u8bbe\u7f6e\u5e72\u6270\u5f3a\u5ea6\n    cap.SetDisturbance(captcha.MEDIUM)\n\n    // \u8bbe\u7f6e\u524d\u666f\u8272\n    cap.SetFrontColor(color.RGBA{0,0,0, 255})\n\n    // \u8bbe\u7f6e\u80cc\u666f\u8272\n    cap.SetBkgColor(color.RGBA{100,0,255, 255}, color.RGBA{255,0,127, 255}, color.RGB{255,255,10, 255})\n\n    // \u751f\u6210\u5b57\u4f53 -- \u5c06\u56fe\u7247\u9a8c\u8bc1\u7801, \u5c55\u793a\u5230\u9875\u9762\u4e2d.\n    http.HandleFunc("/r", func(w http.ResponseWriter, r *http.Request) {\n        img, str := cap.Create(4, captcha.NUM)\n        png.Encode(w, img)\n\n        println(str)\n    })\n\n    // \u6216\u8005 \u81ea\u5b9a\u56fa\u5b9a\u7684\u6570\u636e,\u6765\u505a\u56fe\u7247\u5185\u5bb9.\n    http.HandleFunc("/c", func(w http.ResponseWriter, r *http.Request) {\n        str := "itcast"\n        img := cap.CreateCustom(str)\n        png.Encode(w, img)\n    })\n\n    // \u542f\u52a8\u670d\u52a1\n    http.ListenAndServe(":8086", nil)\n}\n')),(0,l.kt)("h2",{id:"\u56fe\u7247\u9a8c\u8bc1\u7801\u6a21\u5757\u96c6\u6210\u5230web"},"\u56fe\u7247\u9a8c\u8bc1\u7801\u6a21\u5757\u96c6\u6210\u5230web"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5c06 ImgTest.go \u4e2d\u7684\u6d4b\u8bd5\u4ee3\u7801\uff0c \u7c98\u8d34\u5230 web/controller/user.go \u4e2d\u7684 GetImageCd() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ol"},"\u5bfc\u5165\u9700\u8981\u7684\u5305\u3002 \u5c06 \u201ccomic.ttf\u201d \u6587\u4ef6 \u5b58\u653e\u5230 web/conf/ \u4e2d\u3002 \u5bf9\u5e94\u4fee\u6539\u8bbf\u95ee\u4ee3\u7801\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u6d4f\u89c8\u5668\u4e2d\uff0c\u201c\u6ce8\u518c\u201d \u9875\u9762\u6d4b\u8bd5\uff01")),(0,l.kt)("h2",{id:"\u5fae\u670d\u52a1\u5b9e\u73b0-\u56fe\u7247\u9a8c\u8bc1\u7801"},"\u5fae\u670d\u52a1\u5b9e\u73b0 \u56fe\u7247\u9a8c\u8bc1\u7801"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u521b\u5efa \u5fae\u670d\u52a1\u9879\u76ee\uff1a  ",(0,l.kt)("inlineCode",{parentName:"p"},"micro new --type srv bj38web/service/getCaptcha")),(0,l.kt)("p",{parentName:"li"},"\u521b\u5efa\u5b8c\u6210\uff0c\u4f1a\u5728\u9879\u76ee bj38web \u7684 service/ \u4e2d\uff0c\u591a\u51fa getCaptcha \u7684\u5fae\u670d\u52a1\u9879\u76ee\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fee\u6539\u5bc6\u7801\u672c \u2014\u2014 getCaptcha/proto/getCaptcha.proto"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage go.micro.srv.getCaptcha;\n\nservice GetCaptcha {\n    rpc Call(Request) returns (Response) {}\n}\nmessage Request {\n}\nmessage Response {\n    // \u4f7f\u7528\u5207\u7247\u5b58\u50a8\u56fe\u7247\u4fe1\u606f, \u7528 json \u5e8f\u5217\u5316\n    bytes img = 1;\n}\n')),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u7f16\u8bd1 proto \u6587\u4ef6\u3002 \u2014\u2014 make \u547d\u4ee4\uff01\u5f97\u5230 getCaptcha.micro.go  \u548c getCaptcha.pb.go")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fee\u6539 service/getCaptcha/main.go "))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'import (\n    "github.com/micro/go-micro/util/log"\n    "github.com/micro/go-micro"\n    "bj38web/service/getCaptcha/handler"\n\n    getCaptcha "bj38web/service/getCaptcha/proto/getCaptcha"\n)\n\nfunc main() {\n    // New Service\n    service := micro.NewService(\n        micro.Name("go.micro.srv.getCaptcha"),\n        micro.Version("latest"),\n    )\n    // Register Handler\n    getCaptcha.RegisterGetCaptchaHandler(service.Server(), new(handler.GetCaptcha))\n\n    // Run service\n    if err := service.Run(); err != nil {\n        log.Fatal(err)\n    }\n}\n')),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fee\u6539\u670d\u52a1\u53d1\u73b0 \uff1a mdns \u2014\u2014> consul"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u521d\u59cb\u5316consul")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u6dfb\u52a0 consul \u5230  micro.NewSerive( )"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'consulReg := consul.NewRegistry()\n\n// New Service\nservice := micro.NewService(\n    micro.Address("192.168.6.108:12341"),  // \u9632\u6b62\u968f\u673a\u751f\u6210 port \n    micro.Name("go.micro.srv.getCaptcha"),\n    micro.Registry(consulReg),              // \u6dfb\u52a0\u6ce8\u518c\n    micro.Version("latest"),\n)\n')),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u542f\u52a8 consul \uff0c consul agent -dev ")),(0,l.kt)("ol",{start:6},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fee\u6539 handler/getCaptcha.go \u6587\u4ef6\u3002"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5220\u9664  \u9664  Call \u4ee5\u5916\u7684 \u5176\u4ed6 \u6240\u6709\u51fd\u6570\u3002\u2014\u2014 \u53d7 .proto \u6587\u4ef6\u5236\u7ea6\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u6e05\u7a7a Call \u65b9\u6cd5\u3002\u51c6\u5907\u6dfb\u52a0\u5177\u4f53\u5b9e\u73b0\u4ee3\u7801\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5c06 \u4e4b\u524d\u5b9e\u73b0\u7684\u56fe\u7247\u9a8c\u8bc1\u7801\u6d4b\u8bd5\u6a21\u5757\u4ee3\u7801\uff0c \u526a\u5207\u5230 Call\u65b9\u6cd5\u4e2d\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5728 getCaptcha/ \u4e0b \uff0c \u6dfb\u52a0 conf/comic.ttf ")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5c06 \u751f\u6210\u7684\u56fe\u7247\u9a8c\u8bc1\u7801\uff0c\u5199\u6210 json \u5e8f\u5217\u5316\u6570\u636e\uff0c \u901a\u8fc7 rsp \u53c2\u6570\u4f20\u51fa\uff01"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'func (e *GetCaptcha) Call(ctx context.Context, req *getCaptcha.Request, rs*getCaptcha.Response) error {\n    // \u751f\u6210\u56fe\u7247\u9a8c\u8bc1\u7801\n\n    // \u521d\u59cb\u5316\u5bf9\u8c61\n    cap := captcha.New()\n\n    // \u8bbe\u7f6e\u5b57\u4f53\n    cap.SetFont("./conf/comic.ttf")\n\n    // \u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5927\u5c0f\n    cap.SetSize(128, 64)\n\n    // \u8bbe\u7f6e\u5e72\u6270\u5f3a\u5ea6\n    cap.SetDisturbance(captcha.NORMAL)\n\n    // \u8bbe\u7f6e\u524d\u666f\u8272\n    cap.SetFrontColor(color.RGBA{0,0,0, 255})\n\n    // \u8bbe\u7f6e\u80cc\u666f\u8272\n    cap.SetBkgColor(color.RGBA{100,0,255, 255}, color.RGBA{255,0,127, 255}, coloRGBA{255,255,10, 255})\n\n    // \u751f\u6210\u5b57\u4f53\n    img, _ := cap.Create(4, captcha.NUM)\n\n    // \u5c06 \u751f\u6210\u6210\u7684\u56fe\u7247 \u5e8f\u5217\u5316.\n    imgBuf, _ := json.Marshal(img)\n\n    // \u5c06 imgBuf \u4f7f\u7528 \u53c2\u6570 rsp \u4f20\u51fa\n    rsp.Img = imgBuf\n\n    return nil\n}\n')),(0,l.kt)("h2",{id:"web\u7aef\u5bf9\u63a5\u5fae\u670d\u52a1\u5b9e\u73b0"},"web\u7aef\u5bf9\u63a5\u5fae\u670d\u52a1\u5b9e\u73b0"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u62f7\u8d1d\u5bc6\u7801\u672c\u3002 \u5c06 service \u4e0b\u7684 proto/  \u62f7\u8d1d web/   \u4e0b")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5728 GetImageCd() \u4e2d \u5bfc\u5165\u5305\uff0c\u8d77\u522b\u540d\uff1a"),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},'getCaptcha "bj38web/web/proto/getCaptcha" '))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u6307\u5b9aconsul \u670d\u52a1\u53d1\u73b0\uff1a"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"// \u6307\u5b9a consul \u670d\u52a1\u53d1\u73b0\nconsulReg := consul.NewRegistry()\n\nconsulService := micro.NewService(\n    micro.Registry(consulReg),\n)\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u521d\u59cb\u5316\u5ba2\u6237\u7aef")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'microClient := getCaptcha.NewGetCaptchaService("getCaptcha", consulService.Client())\n\n')),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528\u8fdc\u7a0b\u51fd\u6570")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'resp, err := microClient.Call(context.TODO(), &getCaptcha.Request{})\nif err != nil {\n    fmt.Println("\u672a\u627e\u5230\u8fdc\u7a0b\u670d\u52a1...")\n    return\n}\n')),(0,l.kt)("ol",{start:6},(0,l.kt)("li",{parentName:"ol"},"\u5c06\u5f97\u5230\u7684\u6570\u636e,\u53cd\u5e8f\u5217\u5316,\u5f97\u5230\u56fe\u7247\u6570\u636e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"var img captcha.Image\njson.Unmarshal(resp.Img, &img)\n")),(0,l.kt)("ol",{start:7},(0,l.kt)("li",{parentName:"ol"},"\u5c06\u56fe\u7247\u5199\u51fa\u5230 \u6d4f\u89c8\u5668.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"png.Encode(ctx.Writer, img)\n")),(0,l.kt)("ol",{start:8},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u6d4b\u8bd5\uff1a"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u542f\u52a8 consul  \uff0c  consul agent -dev"),(0,l.kt)("li",{parentName:"ol"},"\u542f\u52a8 service/  \u4e0b\u7684  main.go"),(0,l.kt)("li",{parentName:"ol"},"\u542f\u52a8 web/ \u4e0b\u7684  main.go"),(0,l.kt)("li",{parentName:"ol"},"\u6d4f\u89c8\u5668\u4e2d 192.168.IP: port/home    \u70b9\u51fb\u6ce8\u518c \u67e5\u770b\u56fe\u7247\u9a8c\u8bc1\u7801\uff01")))),(0,l.kt)("h2",{id:"\u8fde\u63a5\u5f62\u5f0f"},"\u8fde\u63a5\u5f62\u5f0f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u957f\u8fde\u63a5\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"TCP\u3002\u2014\u2014 \u6709\u72b6\u6001\uff01"))),(0,l.kt)("li",{parentName:"ul"},"\u77ed\u8fde\u63a5\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"http\u3002\u2014\u2014 \u65e0\u72b6\u6001\uff01\u65ad\u5f00\u540e\uff0c\u518d\u53d1\u9001\u8bf7\u6c42\uff0c\u4e0e\u4e0a\u6b21\u53d1\u9001\u65e0\u5173\uff01",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9009\u7528\u5e26\u6709 \u201c\u65f6\u6548\u6027\u201d \u7684\u4ecb\u8d28\uff0c\u5b58\u50a8\u3002 \u2014\u2014 redis\u6570\u636e\u5e93\u3002setex --- expire\u3002")))))))}s.isMDXComponent=!0}}]);